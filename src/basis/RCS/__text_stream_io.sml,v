head	1.2;
access;
symbols
	MLW_daveb_inline_1_4_99:1.2.1
	MLWorks_21c0_1999_03_25:1.2
	MLWorks_20c1_1998_08_20:1.1
	MLWorks_20c0_1998_08_04:1.1
	MLWorks_20b2c2_1998_06_19:1.1
	MLWorks_20b2_Windows_1998_06_12:1.1
	MLWorks_20b1c1_1998_05_07:1.1
	MLWorks_20b0_1998_04_07:1.1
	MLWorks_20b0_1998_03_20:1.1
	MLWorks_20m2_1998_02_16:1.1
	MLWorks_20m1_1997_10_23:1.1
	MLWorks_11r1:1.1.1.1.1.1.1
	MLWorks_workspace_97:1.1.3
	MLWorks_dt_wizard:1.1.2
	MLWorks_11c0_1997_09_09:1.1.1.1.1.1
	MLWorks_10r3:1.1.1.1.3
	MLWorks_10r2_551:1.1.1.1.2
	MLWorks_11:1.1.1.1.1
	MLWorks_1_0_r2c2_1997_07_28:1.1.1.1
	MLWorks_20m0_1997_06_20:1.1
	MLWorks_1_0_r2c2_1997_06_14:1.1.1.1
	MLWorks_1_0_r2c1_released_1997_05_23:1.1.1.1
	MLWorks_1_0_r2c1_1997_05_12:1.1.1
	MLWorks_BugFix_1997_04_24:1.1
	MLWorks_1_0_r2_Win32_1997_04_11:1.1
	MLWorks_1_0_r2_Unix_1997_04_04:1.1;
locks; strict;
comment	@ *  @;


1.2
date	99.02.02.15.58.25;	author mitchell;	state Exp;
branches
	1.2.1.1;
next	1.1;

1.1
date	97.02.26.16.34.25;	author andreww;	state Exp;
branches
	1.1.1.1
	1.1.2.1
	1.1.3.1;
next	;

1.1.1.1
date	97.05.12.10.27.41;	author hope;	state Exp;
branches
	1.1.1.1.1.1
	1.1.1.1.2.1
	1.1.1.1.3.1;
next	;

1.1.1.1.1.1
date	97.07.28.18.14.33;	author daveb;	state Exp;
branches
	1.1.1.1.1.1.1.1;
next	;

1.1.1.1.1.1.1.1
date	97.10.07.11.39.39;	author jkbrook;	state Exp;
branches;
next	;

1.1.1.1.2.1
date	97.09.08.17.08.00;	author daveb;	state Exp;
branches;
next	;

1.1.1.1.3.1
date	97.09.09.14.03.10;	author daveb;	state Exp;
branches;
next	;

1.1.2.1
date	97.09.10.19.17.38;	author brucem;	state Exp;
branches;
next	;

1.1.3.1
date	97.09.11.20.48.24;	author daveb;	state Exp;
branches;
next	;

1.2.1.1
date	99.04.01.17.52.40;	author daveb;	state Exp;
branches;
next	;


desc
@new unit
[Bug #1759]
__stream_io.sml --> __{bin,text}_stream_io.sml
@


1.2
log
@[Bug #190500]
Remove redundant require statements
@
text
@(*  ==== INITIAL BASIS : TextStreamIO structure ====
 *
 *  Copyright (C) 1997 Harlequin Ltd.
 *
 *  Description
 *  -----------
 *  This is part of the extended Initial Basis.
 *
 *  $Log: __text_stream_io.sml,v $
 *  Revision 1.1  1997/02/26  16:34:25  andreww
 *  new unit
 *  [Bug #1759]
 *  __stream_io.sml --> __{bin,text}_stream_io.sml
 *
 *
 *  Revision 1.5  1997/01/15  12:04:07  io
 *  [Bug #1892]
 *  rename __word{8,16,32}{array,vector} to __word{8,16,32}_{array,vector}
 *
 *  Revision 1.4  1996/11/16  01:57:11  io
 *  [Bug #1757]
 *  renamed __char{array,vector} to __char_{array,vector}
 *
 *  Revision 1.3  1996/07/18  14:54:43  andreww
 *  [Bug #1453]
 *  Bringing up to date with naming conventions.
 *  (of filenames of modules).
 *
 *  Revision 1.2  1996/06/03  10:12:56  andreww
 *  altering require constraints.
 *
 *  Revision 1.1  1996/05/30  13:53:49  andreww
 *  new unit
 *  TextStreamIO and BinStreamIO structures.
 *
 *)

require "text_stream_io";
require "_stream_io";
require "__char_vector";
require "__char_array";
require "__char";
require "__substring";
require "__text_prim_io";


structure TextStreamIO: TEXT_STREAM_IO =
struct
  local
    structure S = StreamIO(structure PrimIO = TextPrimIO
                           structure Vector = CharVector
                           structure Array = CharArray
                           val someElem = Char.chr 0);
  in

    fun inputLine (f: S.instream) =
       let
           (* the following function returns a triple:
               (l,b,g), where l is a list of characters
                              b is value of proposition "last char is newline"
                              g is the input stream at the end
            *)

         fun loop(i,g) = case S.input1 g of
            SOME(c, g') =>
              if c = Char.chr 10 then ([c],true,g') 
              else let val (l,b,g'')= loop(i+1,g') in (c::l,b,g'') end
          | NONE => ([],false,g)

         val (l,lastCharNewline,f') = loop(0,f)
       in
         (if l<>[] andalso (not lastCharNewline)
            then implode (l@@[#"\n"])
          else implode l,
          f')
       end
         

     fun outputSubstr(f:S.outstream, ss:Substring.substring) =
       S.output(f,Substring.string ss)


     open S
  end

end

  



@


1.2.1.1
log
@branched from trunk for label MLW_daveb_inline_1_4_99
@
text
@a9 4
 *  Revision 1.2  1999/02/02  15:58:25  mitchell
 *  [Bug #190500]
 *  Remove redundant require statements
 *
@


1.1
log
@new unit
[Bug #1759]
__stream_io.sml --> __{bin,text}_stream_io.sml
@
text
@d9 6
a14 1
 *  $Log:,v $
a38 1
require "^.system.__os_prim_io";
a44 1
require "__position";
@


1.1.3.1
log
@branched from trunk for label MLWorks_workspace_97
@
text
@d9 1
a9 6
 *  $Log: __text_stream_io.sml,v $
 *  Revision 1.1  1997/02/26  16:34:25  andreww
 *  new unit
 *  [Bug #1759]
 *  __stream_io.sml --> __{bin,text}_stream_io.sml
 *
@


1.1.2.1
log
@branched from trunk for label MLWorks_dt_wizard
@
text
@d9 1
a9 6
 *  $Log: __text_stream_io.sml,v $
 *  Revision 1.1  1997/02/26  16:34:25  andreww
 *  new unit
 *  [Bug #1759]
 *  __stream_io.sml --> __{bin,text}_stream_io.sml
 *
@


1.1.1.1
log
@branched from 1.1
@
text
@d9 1
a9 6
 *  $Log: __text_stream_io.sml,v $
 *  Revision 1.1  1997/02/26  16:34:25  andreww
 *  new unit
 *  [Bug #1759]
 *  __stream_io.sml --> __{bin,text}_stream_io.sml
 *
@


1.1.1.1.3.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r3
@
text
@a9 3
 *  Revision 1.1.1.1  1997/05/12  10:27:41  hope
 *  branched from 1.1
 *
@


1.1.1.1.2.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r2_551
@
text
@a9 3
 *  Revision 1.1.1.1  1997/05/12  10:27:41  hope
 *  branched from 1.1
 *
@


1.1.1.1.1.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
@
text
@a9 3
 *  Revision 1.1.1.1  1997/05/12  10:27:41  hope
 *  branched from 1.1
 *
@


1.1.1.1.1.1.1.1
log
@branched from MLWorks_11 for label MLWorks_11r1
@
text
@a9 3
 *  Revision 1.1.1.1.1.1  1997/07/28  18:14:33  daveb
 *  branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
 *
@
