# Makefile for liclient
#
# $HopeName: HQNliclient!makefile(trunk.11) $
#
# Remember that EP and SP BOTH USE THE LICENSE SERVER and client!  Don't go
# putting stuff in here which assumes the server is an EP product: it
# ain't.  Likewise, it ain't an SP product.
#######################################

LIB=${TARGET_MACH}/liclient.a

all: makeTargetDir liclient.a
liclient.a: ${LIB}

include ${MAKEDEFSDIR}/${TARGET_MACH}
# replace this with CCDBG or whatever if you wish...
CCFILE=${CCSPEED}

INCDIRS= \
	-I./export \
	-I${BUILDROOT}/licshar/export \
	-I${BUILDROOT}/standard/export \
	${SRCINC}

OBJECTS= \
	${LIB}(clntrpc.o) \
	${LIB}(lsapi.o)

CFILES_DEPLIB= \
	src/clntrpc.c \
	src/lsapi.c

LNFILES= \
	${TARGET_MACH}/clntrpc.ln \
	${TARGET_MACH}/lsapi.ln


################ The actual rules begin here ###############

makeTargetDir:
	@if [ ! -d ${TARGET_MACH} ] ; then \
            echo "mkdir ${TARGET_MACH}" ; mkdir ${TARGET_MACH} ; else \
            echo "do something to keep ultrix4.2 happy" > /dev/null ; fi

${LIB}: ${OBJECTS}
	${RANLIB} ${LIB}

clean:
	rm -rf ${TARGET_MACH}

lint: ${LNFILES}
	${LINT} ${LNLIBOUT}liclient ${LNFILES} ${LINTLIBS} | tee liclient.lint
	mv llib-lliclient.ln ${TARGET_MACH}/liclient.ln

depend: 
	${MAKEDEPEND} -f - ${DEFS} ${INCDIRS} ${CFILES_DEPLIB} | \
	sed -e 's/^\([^:]*\):/$${LIB}(\1):/' >makefile.dep.${TARGET_MACH}

## The rest of this is because we can't make a default rule which knows
## about subdirectories: .c.a and .c.ln will only work for files like
## ./foo.c, not ./src/foo.c, and only to bar.a(foo.o), not 
## ${TARGET_MACH}/bar.a(foo.o).

${LIB}(clntrpc.o): src/clntrpc.c
	${CCFILE} -o ${TARGET_MACH}/clntrpc.o src/clntrpc.c
	${AR} ${ARFLAGS} ${LIB} ${TARGET_MACH}/clntrpc.o
	rm ${TARGET_MACH}/clntrpc.o

${TARGET_MACH}/clntrpc.ln: src/clntrpc.c
	${LNFILE} ${LNFLAGS} -o ${TARGET_MACH}/clntrpc.ln src/clntrpc.c | tee ${TARGET_MACH}/clntrpc.lint

${LIB}(lsapi.o): src/lsapi.c
	${CCFILE} -o ${TARGET_MACH}/lsapi.o src/lsapi.c
	${AR} ${ARFLAGS} ${LIB} ${TARGET_MACH}/lsapi.o
	rm ${TARGET_MACH}/lsapi.o

${TARGET_MACH}/lsapi.ln: src/lsapi.c
	${LNFILE} ${LNFLAGS} -o ${TARGET_MACH}/lsapi.ln src/lsapi.c | tee ${TARGET_MACH}/lsapi.lint


##########################################
# $Log: makefile,v $
# Revision 1.12  1996/01/09 17:41:38  martin
# [Bug #4420]
# Rename MAKEDEFS to MAKEDEFSDIR since Alpha OSF/1 reserves MAKEDEFS.
#
# Revision 1.11  1996/01/03  11:32:22  nickr
# [Bug #4420]
# use BUILDROOT and MAKEDEFS
#
# Revision 1.10  1995/03/06  19:15:50  freeland
# [Bug #none]
# moving .o files to be in platform-specific locations
#
# Revision 1.9  1994/09/06  19:00:53  sarah
# [Bug #4129]
# Intergraph was upset by having two different rules for makeObjDir
# (the other was in ScriptWorks common.unx), so rename the one here
#
# Revision 1.8  1994/08/05  11:56:09  nickr
# use ${MAKEDEPEND}
#
# Revision 1.7  1994/07/01  13:46:17  luke
# remove dependencies generated by a makedepend
#
# Revision 1.6  1994/06/30  17:50:52  luke
# spell touch right!
#
# Revision 1.5  1994/06/30  17:20:44  luke
# get depend target working correctly
#
# Revision 1.4  1994/05/17  21:01:57  freeland
# Changes to makeObjDir: it seems that ultrix4.2 has a bug such that when if
# does nothing, it returns an error code, and make stops.  So we need to do
# something, even if the objectDir is already there.
#
# Revision 1.3  1994/05/13  09:29:04  nick
# rules of form '${AR} ${ARFLAGS} $@ foo' should be '${AR} ${ARFLAGS} ${LIB} foo'
# (this worked well enough in HQNlicshar!makefile)
#
# Revision 1.2  1994/05/12  15:11:23  freeland
# OSF's make doesn't know about $%, so we can't use those... it's almost a
# good thing that we can't use default rules, then.
#
# Revision 1.1  1994/05/04  14:17:20  freeland
# new file
#

# eof makefile.unx
