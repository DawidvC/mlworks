head	1.2;
access;
symbols
	MLW_daveb_inline_1_4_99:1.2.11
	MLWorks_21c0_1999_03_25:1.2
	MLWorks_20c1_1998_08_20:1.2
	MLWorks_20c0_1998_08_04:1.2
	MLWorks_20b2c2_1998_06_19:1.2
	MLWorks_20b2_Windows_1998_06_12:1.2
	MLWorks_20b1c1_1998_05_07:1.2
	MLWorks_20b0_1998_04_07:1.2
	MLWorks_20b0_1998_03_20:1.2
	MLWorks_20m2_1998_02_16:1.2
	MLWorks_20m1_1997_10_23:1.2
	MLWorks_11r1:1.2.8.1.1.1.1
	MLWorks_workspace_97:1.2.10
	MLWorks_dt_wizard:1.2.9
	MLWorks_11c0_1997_09_09:1.2.8.1.1.1
	MLWorks_10r3:1.2.8.1.3
	MLWorks_10r2_551:1.2.8.1.2
	MLWorks_11:1.2.8.1.1
	MLWorks_1_0_r2c2_1997_07_28:1.2.8.1
	MLWorks_20m0_1997_06_20:1.2
	MLWorks_1_0_r2c2_1997_06_14:1.2.8.1
	MLWorks_1_0_r2c1_released_1997_05_23:1.2.8.1
	MLWorks_1_0_r2c1_1997_05_12:1.2.8
	MLWorks_BugFix_1997_04_24:1.2
	MLWorks_1_0_r2_Win32_1997_04_11:1.2
	MLWorks_1_0_r2_Unix_1997_04_04:1.2
	MLWorks_1_0_1_ULTRASPARC_1997_02_24:1.2.6.1.1
	MLWorks_gui_1996_12_18:1.2.7
	MLWorks_1_0_Win32_1996_12_17:1.2.6
	MLWorks_1_0_Irix_1996_11_28_released_1996_12_17:1.2.4.1.1.1
	MLWorks_1_0_Unix_1996_11_14_released_1996_12_17:1.2.4.1
	MLWorks_1_0_Irix_1996_11_28:1.2.4.1.1
	MLWorks_1_0_Win32_1996_11_22:1.2.5
	MLWorks_1_0_Unix_1996_11_14:1.2.4
	MLWorks_Open_Beta2_1996_10_11:1.2.3
	MLWorks_License_dev:1.2.2
	MLWorks_1_open_beta_1996_09_13:1.2.1
	MLWorks_Open_Beta_1996_08_22:1.2
	MLWorks_Beta_1996_07_02:1.2
	MLWorks_Beta_1996_06_07:1.2
	MLWorks_Beta_1996_06_06:1.2
	MLWorks_Beta_1996_06_05:1.2
	MLWorks_Beta_1996_06_03:1.2
	MLWorks_Beta_1996_05_31:1.2
	MLWorks_Beta_1996_05_30:1.2;
locks; strict;
comment	@# @;


1.2
date	96.02.16.15.01.41;	author daveb;	state Exp;
branches
	1.2.1.1
	1.2.2.1
	1.2.3.1
	1.2.4.1
	1.2.5.1
	1.2.6.1
	1.2.7.1
	1.2.8.1
	1.2.9.1
	1.2.10.1
	1.2.11.1;
next	1.1;

1.1
date	96.02.09.16.59.27;	author daveb;	state Exp;
branches;
next	;

1.2.1.1
date	96.09.13.11.26.54;	author hope;	state Exp;
branches;
next	;

1.2.2.1
date	96.10.07.16.17.27;	author hope;	state Exp;
branches;
next	;

1.2.3.1
date	96.10.17.11.37.18;	author hope;	state Exp;
branches;
next	;

1.2.4.1
date	96.11.14.13.05.11;	author hope;	state Exp;
branches
	1.2.4.1.1.1;
next	;

1.2.4.1.1.1
date	96.11.28.15.14.42;	author hope;	state Exp;
branches;
next	;

1.2.5.1
date	96.11.22.18.22.38;	author hope;	state Exp;
branches;
next	;

1.2.6.1
date	96.12.17.18.00.39;	author hope;	state Exp;
branches
	1.2.6.1.1.1;
next	;

1.2.6.1.1.1
date	97.02.24.11.52.21;	author hope;	state Exp;
branches;
next	;

1.2.7.1
date	96.12.18.09.56.02;	author hope;	state Exp;
branches;
next	;

1.2.8.1
date	97.05.12.10.50.44;	author hope;	state Exp;
branches
	1.2.8.1.1.1
	1.2.8.1.2.1
	1.2.8.1.3.1;
next	;

1.2.8.1.1.1
date	97.07.28.18.32.57;	author daveb;	state Exp;
branches
	1.2.8.1.1.1.1.1;
next	;

1.2.8.1.1.1.1.1
date	97.10.07.11.58.58;	author jkbrook;	state Exp;
branches;
next	;

1.2.8.1.2.1
date	97.09.08.17.26.05;	author daveb;	state Exp;
branches;
next	;

1.2.8.1.3.1
date	97.09.09.14.22.52;	author daveb;	state Exp;
branches;
next	;

1.2.9.1
date	97.09.10.19.41.52;	author brucem;	state Exp;
branches;
next	;

1.2.10.1
date	97.09.11.21.09.24;	author daveb;	state Exp;
branches;
next	;

1.2.11.1
date	99.04.01.18.08.11;	author daveb;	state Exp;
branches;
next	;


desc
@new unit
Input file for generating mlworks-server.el.
@


1.2
log
@Replaced use of "unless" with "if", for portability.
@
text
@;;;	==== MLWORKS EMACS SERVER ====
;;;
;;; Copyright (C) 1993 Harlequin Ltd
;;;
;;; This file is part of MLWorks.  Consult MLWorks documentation for
;;; details of how to use the MLWorks server.
;;;
;;; $Id: mlworks-server.el.in,v 1.1 1996/02/09 16:59:27 daveb Exp $

(defvar mlworks-server:program "$LIBDIR/emacs/etc/mlworks-server"
  "The path of the program which listens for MLWorks Emacs server requests.")

(defvar mlworks-server:process nil
  "The Emacs process object of the server process, or nil if never started.")

(defvar mlworks-server:buffer "*MLWorks server*"
  "The name of a buffer to which server requests and messages are appended.
This facility is provided purely for the information of the user.  No
buffer is used if this variable is nil.")

(defun mlworks-server ()
  "Start the MLWorks Emacs server.
The server listens for requests from MLWorks to edit files and pops
them up in a buffer."
  (interactive)
  (and mlworks-server:process
       (delete-process mlworks-server:process))
  (setq mlworks-server:process
	(start-process "mlworks-server" nil
		       mlworks-server:program))
  (set-process-filter mlworks-server:process 'mlworks-server:filter)
  (process-kill-without-query mlworks-server:process)
  (if mlworks-server:buffer
      (bury-buffer (get-buffer-create mlworks-server:buffer)))
  mlworks-server:process)

(defun mlworks-server:filter (process string)
  "Filter function for the MLWorks Emacs server process.
The server process sends Emacs lisp expressions.  These are appended
to the buffer mlworks-server:buffer if it is non-nil, then evaluated."
  (if mlworks-server:buffer
      (save-excursion
	(switch-to-buffer mlworks-server:buffer)
	(goto-char (point-max))
	(insert "[")
	(insert string)
	(insert "]")
	(bury-buffer)))
  (eval (read string)))

(defun mlworks-x-y-to-pos (x y)
   "Converts a line and column in MLWorks co-ordinates to an emacs position"
   (save-excursion
      (goto-char (point-min))
      (next-line (1- x))
      (+ (point) (1- y))))
   
(defvar mlworks-overlay nil "The current highlighted overlay")

(defun mlworks-unhighlight ()
   "Removes an existing mlworks highlight"
   (interactive)
   (if (null mlworks-overlay) () (delete-overlay mlworks-overlay)))

(defun mlworks-undo-highlight (begin end)
   "Version of mlworks-unhighlight for installation on the before-changes hook"
   (if (null mlworks-overlay)
       ()
       (if (eq (overlay-buffer mlworks-overlay) (current-buffer))
           (mlworks-unhighlight)
           ())))
	
(make-variable-buffer-local 'mlworks-undo-highlight-installed)

(defvar mlworks-undo-highlight-installed nil
   "True if we have installed a change function")

(defun mlworks-install-change-fn ()
   "Installs a function that removes the highlight when the buffer is changed"
    (interactive)
    (if mlworks-undo-highlight-installed
	()
        (progn
           (make-local-variable 'before-change-functions)
           (setq before-change-functions
                 (cons 'mlworks-undo-highlight before-change-functions))
	   (put 'before-change-functions 'permanent-local t)
           (setq mlworks-undo-highlight-installed t)
	   (put 'mlworks-undo-highlight-installed 'permanent-local t))))

(defun mlworks-highlight (s_line s_col e_line e_col)
   "Highlights a section of text specified by two points given in MLWorks
co-ordinates"
   (let* ((start-pos (mlworks-x-y-to-pos s_line s_col))
          (end-pos (mlworks-x-y-to-pos e_line (1+ e_col)))
          (overlay (make-overlay start-pos end-pos)))
      (mlworks-unhighlight)
      (overlay-put overlay 'face 'highlight)
      (mlworks-install-change-fn)
      (setq mlworks-overlay overlay)
      'highlight))

;; Raises the window showing a specified buffer

(defun raise-window (buffer)
     "Raise the frame showing BUFFER to the top."
     (interactive "bRaise buffer: ")
     (let ((window (get-buffer-window buffer 0)))
          (cond (window (raise-frame (window-frame window)))
                (t (error "Current buffer not in any frame")))))

;; Raises the window showing the current buffer

(defun raise-this-window ()
     "Raise the frame showing the current buffer to the top."
     (interactive)
     (raise-window (current-buffer)))

@


1.2.11.1
log
@branched from trunk for label MLW_daveb_inline_1_4_99
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.10.1
log
@branched from trunk for label MLWorks_workspace_97
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.9.1
log
@branched from trunk for label MLWorks_dt_wizard
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.8.1
log
@branched from 1.2
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.8.1.3.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r3
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2.8.1 1997/05/12 10:50:44 hope Exp $
@


1.2.8.1.2.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r2_551
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2.8.1 1997/05/12 10:50:44 hope Exp $
@


1.2.8.1.1.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2.8.1 1997/05/12 10:50:44 hope Exp $
@


1.2.8.1.1.1.1.1
log
@branched from MLWorks_11 for label MLWorks_11r1
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2.8.1.1.1 1997/07/28 18:32:57 daveb Exp $
@


1.2.7.1
log
@branched from 1.2
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.6.1
log
@branched from 1.2
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.6.1.1.1
log
@branched from 1.2.6.1
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2.6.1 1996/12/17 18:00:39 hope Exp $
@


1.2.5.1
log
@branched from 1.2
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.4.1
log
@branched from 1.2
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.4.1.1.1
log
@branched from 1.2.4.1
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2.4.1 1996/11/14 13:05:11 hope Exp $
@


1.2.3.1
log
@branched from 1.2
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.2.1
log
@branched from 1.2
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.2.1.1
log
@branched from 1.2
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el.in,v 1.2 1996/02/16 15:01:41 daveb Exp $
@


1.1
log
@new unit
Input file for generating mlworks-server.el.
@
text
@d8 1
a8 1
;;; $Id: mlworks-server.el,v 1.10 1995/10/23 17:46:21 daveb Exp $
d81 9
a89 7
    (unless mlworks-undo-highlight-installed
        (make-local-variable 'before-change-functions)
        (setq before-change-functions
              (cons 'mlworks-undo-highlight before-change-functions))
	(put 'before-change-functions 'permanent-local t)
        (setq mlworks-undo-highlight-installed t)
	(put 'mlworks-undo-highlight-installed 'permanent-local t)))
@
