head	1.2;
access;
symbols
	MLW_daveb_inline_1_4_99:1.2.3
	MLWorks_21c0_1999_03_25:1.2
	MLWorks_20c1_1998_08_20:1.2
	MLWorks_20c0_1998_08_04:1.2
	MLWorks_20b2c2_1998_06_19:1.2
	MLWorks_20b2_Windows_1998_06_12:1.2
	MLWorks_20b1c1_1998_05_07:1.2
	MLWorks_20b0_1998_04_07:1.2
	MLWorks_20b0_1998_03_20:1.2
	MLWorks_20m2_1998_02_16:1.2
	MLWorks_20m1_1997_10_23:1.2
	MLWorks_workspace_97:1.2.2
	MLWorks_dt_wizard:1.2.1;
locks; strict;
comment	@ *  @;


1.2
date	97.07.03.09.39.00;	author stephenb;	state Exp;
branches
	1.2.1.1
	1.2.2.1
	1.2.3.1;
next	1.1;

1.1
date	97.07.02.09.48.46;	author stephenb;	state Exp;
branches;
next	;

1.2.1.1
date	97.09.10.19.19.50;	author brucem;	state Exp;
branches;
next	;

1.2.2.1
date	97.09.11.20.51.02;	author daveb;	state Exp;
branches;
next	;

1.2.3.1
date	99.04.01.17.54.45;	author daveb;	state Exp;
branches;
next	;


desc
@new unit
** No reason given. **
@


1.2
log
@Automatic checkin:
changed attribute _comment to ' *  '
@
text
@(* Copyright (C) 1997 The Harlequin Group Limited.  All rights reserved.
 *
 * An interface to <stdio.h> in C 
 *
 * Revision Log
 * ------------
 * $Log$
 *)

require "^.basis.__char_array";
require "^.basis.__char_vector";
require "^.basis.__real_array";
require "^.basis.__real_vector";
require "__mlworks_dynamic_library";
require "__mlworks_c_interface";
require "mlworks_c_io";

structure MLWorksCIO : MLWORKS_C_IO =
  struct
    structure C = MLWorksCInterface

    type c_char = MLWorksCInterface.Char.char
    type c_int = MLWorksCInterface.Int.int
    type void = MLWorksCInterface.void
    type 'a ptr = 'a MLWorksCInterface.ptr

    datatype FILE = FILE of void ptr

    type size_t = C.Uint.word

    val bind = MLWorksDynamicLibrary.bind

    val EOF : c_int = C.Int.fromInt ~1


    val clearerr : FILE ptr -> unit = bind "mlw clearerr"

    val fclose : FILE ptr -> int = bind "mlw fclose"

    val ferror : FILE ptr -> c_int = bind "mlw ferror"

    val feof : FILE ptr -> c_int = bind "mlw feof"

    val fgetc : FILE ptr -> c_int = bind "mlw fgetc"

    val fopen : string * string -> FILE ptr = bind "mlw fopen"

    val fputc : FILE ptr * c_char -> c_int = bind "mlw fputc"

    val fputs : FILE ptr * c_char ptr -> c_int = bind "mlw fputs"

    val fputString : FILE ptr * string -> c_int = bind "mlw fput string"

    val fflush : FILE ptr -> c_int = bind "mlw fflush"

    val fread : void ptr * size_t * size_t * FILE ptr -> size_t =
      bind "mlw fread"


    val freadCharArray_ : CharArray.array * int * int * FILE ptr -> int =
      bind "mlw fread char array"

    fun freadCharArray (vector, offset, n, file) =
      if n = 0 then
        n
      else if offset < 0
      orelse n < 0
      orelse (offset-1)+n > CharArray.length vector then
        raise Subscript
      else
        freadCharArray_ (vector, offset, n, file)



    val freadRealArray_ : RealArray.array * int * int * FILE ptr -> int =
      bind "mlw fread real array"
     
    fun freadRealArray (vector, offset, n, file) =
      if n = 0 then
        n
      else if offset < 0
      orelse n < 0
      orelse (offset-1)+n > RealArray.length vector then
        raise Subscript
      else
        freadRealArray_ (vector, offset, n, file)

    (* Add IntVector Int32Vector, ... etc. when MLWorks supports them *)



    val freopen : string * string * FILE ptr -> FILE ptr = bind "mlw freopen"

    val fseek : FILE ptr * C.Long.int * c_int -> c_int =bind "mlw fseek"

    val ftell : FILE ptr -> C.Long.int = bind "mlw ftell"

    val fwrite : void ptr * size_t * size_t * FILE ptr -> size_t =
      bind "mlw fwrite"


    val fwriteCharArray_ : CharArray.array * int * int * FILE ptr -> int =
      bind "mlw fwrite char array"

    fun fwriteCharArray (vector, offset, n, file) =
      if n = 0 then
        n
      else if offset < 0
      orelse n < 0
      orelse (offset-1)+n > CharArray.length vector then
        raise Subscript
      else
        fwriteCharArray_ (vector, offset, n, file)



    val fwriteCharVector_ : CharVector.vector * int * int * FILE ptr -> int =
      bind "mlw fwrite char vector"

    fun fwriteCharVector (vector, offset, n, file) =
      if n = 0 then
        n
      else if offset < 0
      orelse n < 0
      orelse (offset-1)+n > CharVector.length vector then
        raise Subscript
      else
        fwriteCharVector_ (vector, offset, n, file)



    val fwriteRealArray_ : RealArray.array * int * int * FILE ptr -> int =
      bind "mlw fwrite real array"

    fun fwriteRealArray (vector, offset, n, file) =
      if n = 0 then
        n
      else if offset < 0
      orelse n < 0
      orelse (offset-1)+n > RealArray.length vector then
        raise Subscript
      else
        fwriteRealArray_ (vector, offset, n, file)



    val fwriteRealVector_ : RealVector.vector * int * int * FILE ptr -> int =
      bind "mlw fwrite real vector"

    fun fwriteRealVector (vector, offset, n, file) =
      if n = 0 then
        n
      else if offset < 0
      orelse n < 0
      orelse (offset-1)+n > RealVector.length vector then
        raise Subscript
      else
        fwriteRealVector_ (vector, offset, n, file)



    val fwriteString_ : string * int * int * FILE ptr -> int =
      bind "mlw fwrite string"

    fun fwriteString (string, offset, n, file) =
      if n = 0 then
        n
      else if offset < 0
      orelse n < 0
      orelse (offset-1)+n > size string then
        raise Subscript
      else
        fwriteString_ (string, offset, n, file)


    (* Add IntVector Int32Vector, ... etc. when MLWorks supports them *)



    val setvbuff : FILE ptr * c_char ptr * c_int * size_t -> c_int =
      bind "mlw setvbuf"

    val perror : c_char ptr -> unit = bind "mlw perror"

    val perrorString : string -> unit = bind "mlw perror string"

    val setbuff : FILE ptr * c_char -> unit = bind "mlw setbuf"

    val stdin  : unit -> FILE ptr = bind "mlw stdin"

    val stdout : unit -> FILE ptr = bind "mlw stdout"

    val stderr : unit -> FILE ptr = bind "mlw stderr"

    val ungetc : FILE ptr * c_int -> c_int = bind "mlw ungetc"

  end
@


1.2.3.1
log
@branched from trunk for label MLW_daveb_inline_1_4_99
@
text
@d7 1
a7 5
 * $Log: __mlworks_c_io.sml,v $
 *  Revision 1.2  1997/07/03  09:39:00  stephenb
 *  Automatic checkin:
 *  changed attribute _comment to ' *  '
 *
@


1.2.2.1
log
@branched from trunk for label MLWorks_workspace_97
@
text
@d7 1
a7 5
 * $Log: __mlworks_c_io.sml,v $
 *  Revision 1.2  1997/07/03  09:39:00  stephenb
 *  Automatic checkin:
 *  changed attribute _comment to ' *  '
 *
@


1.2.1.1
log
@branched from trunk for label MLWorks_dt_wizard
@
text
@d7 1
a7 5
 * $Log: __mlworks_c_io.sml,v $
 *  Revision 1.2  1997/07/03  09:39:00  stephenb
 *  Automatic checkin:
 *  changed attribute _comment to ' *  '
 *
@


1.1
log
@new unit
** No reason given. **
@
text
@@
