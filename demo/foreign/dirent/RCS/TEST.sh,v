head	1.3;
access;
symbols
	MLWorks_21c0_1999_03_25:1.3
	MLWorks_20c1_1998_08_20:1.3
	MLWorks_20c0_1998_08_04:1.3
	MLWorks_20b2c2_1998_06_19:1.3
	MLWorks_20b2_Windows_1998_06_12:1.3
	MLWorks_20b1c1_1998_05_07:1.3
	MLWorks_20b0_1998_04_07:1.3
	MLWorks_20b0_1998_03_20:1.3
	MLWorks_20m2_1998_02_16:1.3
	MLWorks_workspace_97:1.2.1
	MLWorks_20m1_1997_10_23:1.2;
locks; strict;
comment	@# @;


1.3
date	98.01.23.11.53.59;	author jkbrook;	state Exp;
branches;
next	1.2;

1.2
date	97.07.07.13.36.53;	author stephenb;	state Exp;
branches
	1.2.1.1;
next	1.1;

1.1
date	97.06.30.15.35.24;	author stephenb;	state Exp;
branches;
next	;

1.2.1.1
date	97.11.30.16.49.04;	author daveb;	state Exp;
branches;
next	;


desc
@new unit
** No reason given. **
@


1.3
log
@[Bug #70047]
Shouldn't print `dumped ok' if executable delivery fails
@
text
@#!/bin/sh
#
# Copyright (C) 1997 The Harlequin Group Limited.  All rights reserved.
# 
# This file is deliberatly UNIXocentric since the ls test only runs under Unix.
#
# Revision Log
# ------------
# $Log: foreign:dirent:TEST.sh,v $
# Revision 1.2  1997/07/07  13:36:53  stephenb
# [Bug #30038]
# Remove any reference to "phones" (script was cut&paste from
# the ndbm example).
#
# Revision 1.1  1997/06/30  15:35:24  stephenb
# new unit
# ** No reason given. **
#


mlw_src=${1:-../../../src}
mlw_rts=${mlw_src}/rts/bin/$ARCH/$OS/main
mlw_image=${mlw_src}/images/$ARCH/$OS/gui.img
mlw_pervasive=${mlw_src}/pervasive
mlw_include=${mlw_src}/rts/src

LD_LIBRARY_PATH=.${LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH}
export LD_LIBRARY_PATH

mlw_src_path=.:${mlw_src}


#
# Make sure the script cleans up after itself.
#

trap "{ rm -rf simplels test-dir ; make -s -f Makefile.${OS} clean; }" 0 1


#
# Build the shared library ...
#

if { make -s -f Makefile.${OS} MLWORKS_INCLUDE=${mlw_include} clean all; }
then
  echo "make ok" 
else
  echo "make failed"
  exit 1
fi


#
# Load in the ls code and dump an executable ...
#

if { ${mlw_rts} -c 15 -batch -load ${mlw_image} -pass args -silent -tty -pervasive-dir ${mlw_pervasive} -source-path ${mlw_src_path} args < TEST.sml 1>/dev/null 2>&1 && test -f ./simplels; }
then
  echo "dump ok"
else
  echo "dump failed"
  exit 1
fi



#
# Run some tests ...
#
rm -rf test-dir
mkdir test-dir
touch test-dir/a
touch test-dir/b
touch test-dir/c

./simplels -pass args test-dir args
./simplels -pass args /doesnotexist args
@


1.2
log
@[Bug #30038]
Remove any reference to "phones" (script was cut&paste from
the ndbm example).
@
text
@d10 5
d57 1
a57 1
if { ${mlw_rts} -c 15 -batch -load ${mlw_image} -pass args -silent -tty -pervasive-dir ${mlw_pervasive} -source-path ${mlw_src_path} args < TEST.sml 1>/dev/null 2>&1 ; }
@


1.2.1.1
log
@branched from trunk for label MLWorks_workspace_97
@
text
@a9 5
# Revision 1.2  1997/07/07  13:36:53  stephenb
# [Bug #30038]
# Remove any reference to "phones" (script was cut&paste from
# the ndbm example).
#
@


1.1
log
@new unit
** No reason given. **
@
text
@d9 5
a13 1
# $Log$
d22 1
a22 1
LD_LIBRARY_PATH="."
d49 1
a49 1
# Load in the phones code and dump an executable ...
@
