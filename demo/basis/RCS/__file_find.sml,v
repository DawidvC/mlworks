head	1.2;
access;
symbols
	MLWorks_21c0_1999_03_25:1.2
	MLWorks_20c1_1998_08_20:1.2
	MLWorks_20c0_1998_08_04:1.2
	MLWorks_20b2c2_1998_06_19:1.2
	MLWorks_20b2_Windows_1998_06_12:1.2
	MLWorks_20b1c1_1998_05_07:1.2
	MLWorks_20b0_1998_04_07:1.2
	MLWorks_20b0_1998_03_20:1.2
	MLWorks_20m2_1998_02_16:1.2
	MLWorks_workspace_97:1.2.8
	MLWorks_20m1_1997_10_23:1.2
	MLWorks_11r1:1.2.7.1.1.1.1
	MLWorks_11c0_1997_09_09:1.2.7.1.1.1
	MLWorks_10r3:1.2.7.1.3
	MLWorks_10r2_551:1.2.7.1.2
	MLWorks_11:1.2.7.1.1
	MLWorks_1_0_r2c2_1997_07_28:1.2.7.1
	MLWorks_20m0_1997_06_20:1.2
	MLWorks_1_0_r2c2_1997_06_14:1.2.7.1
	MLWorks_1_0_r2c1_released_1997_05_23:1.2.7.1
	MLWorks_1_0_r2c1_1997_05_12:1.2.7
	MLWorks_BugFix_1997_04_24:1.2
	MLWorks_1_0_r2_Win32_1997_04_11:1.2
	MLWorks_1_0_r2_Unix_1997_04_04:1.2
	MLWorks_1_0_1_ULTRASPARC_1997_02_24:1.2.6.1.1
	MLWorks_1_0_Win32_1996_12_17:1.2.6
	MLWorks_1_0_Irix_1996_11_28_released_1996_12_17:1.2.4.1.1.1
	MLWorks_1_0_Unix_1996_11_14_released_1996_12_17:1.2.4.1
	MLWorks_1_0_Irix_1996_11_28:1.2.4.1.1
	MLWorks_1_0_Win32_1996_11_22:1.2.5
	MLWorks_1_0_Unix_1996_11_14:1.2.4
	MLWorks_Open_Beta2_1996_10_11:1.2.3
	MLWorks_License_dev:1.2.2
	MLWorks_1_open_beta_1996_09_13:1.2.1
	MLWorks_Open_Beta_1996_08_22:1.1;
locks; strict;
comment	@ *  @;


1.2
date	96.09.04.11.53.17;	author jont;	state Exp;
branches
	1.2.1.1
	1.2.2.1
	1.2.3.1
	1.2.4.1
	1.2.5.1
	1.2.6.1
	1.2.7.1
	1.2.8.1;
next	1.1;

1.1
date	96.08.02.11.40.06;	author davids;	state Exp;
branches;
next	;

1.2.1.1
date	96.09.13.11.07.36;	author hope;	state Exp;
branches;
next	;

1.2.2.1
date	96.10.07.15.58.46;	author hope;	state Exp;
branches;
next	;

1.2.3.1
date	96.10.17.11.17.09;	author hope;	state Exp;
branches;
next	;

1.2.4.1
date	96.11.14.12.40.36;	author hope;	state Exp;
branches
	1.2.4.1.1.1;
next	;

1.2.4.1.1.1
date	96.11.28.14.52.27;	author hope;	state Exp;
branches;
next	;

1.2.5.1
date	96.11.22.18.01.04;	author hope;	state Exp;
branches;
next	;

1.2.6.1
date	96.12.17.17.39.57;	author hope;	state Exp;
branches
	1.2.6.1.1.1;
next	;

1.2.6.1.1.1
date	97.02.24.11.27.10;	author hope;	state Exp;
branches;
next	;

1.2.7.1
date	97.05.12.10.24.58;	author hope;	state Exp;
branches
	1.2.7.1.1.1
	1.2.7.1.2.1
	1.2.7.1.3.1;
next	;

1.2.7.1.1.1
date	97.07.28.18.10.14;	author daveb;	state Exp;
branches
	1.2.7.1.1.1.1.1;
next	;

1.2.7.1.1.1.1.1
date	97.10.07.11.34.16;	author jkbrook;	state Exp;
branches;
next	;

1.2.7.1.2.1
date	97.09.08.17.03.33;	author daveb;	state Exp;
branches;
next	;

1.2.7.1.3.1
date	97.09.09.13.58.13;	author daveb;	state Exp;
branches;
next	;

1.2.8.1
date	97.11.30.16.47.15;	author daveb;	state Exp;
branches;
next	;


desc
@new unit
@


1.2
log
@Make require statements absolute
@
text
@(*  ==== BASIS EXAMPLES : FileFind structure ====
 *
 *  Copyright (C) 1996 Harlequin Ltd.
 *
 *  Description
 *  -----------
 *  This module provides a function that will search through directories to
 *  find all matches with a given filename or pattern.  It illustrates the
 *  OS structure in the basis library - specifically the OS.FileSys and the
 *  OS.Path structures.
 *
 *  Revision Log
 *  ------------
 *  $Log: basis:__file_find.sml,v $
 *  Revision 1.1  1996/08/02  11:40:06  davids
 *  new unit
 *
 *
 *)


require "file_find";
require "__match";
require "$.system.__os";


structure FileFind : FILE_FIND =
  struct


    (* Test whether file is a directory that isn't "." or ".." or a link. *)

    fun isChildDir file =
      OS.FileSys.isDir file 
      andalso not (OS.FileSys.isLink file)
      andalso file <> "."
      andalso file <> ".."


    (* Check contents of a directory to find all files of name 'filename' *)

    fun checkDir (filename, path) =
      let
        val oldPath = OS.FileSys.getDir ()	  
        val dir = OS.FileSys.openDir path	 
	val _ = OS.FileSys.chDir path
	val fileList = checkFile (filename, dir)  
	val _ = OS.FileSys.chDir oldPath	  
	val _ = OS.FileSys.closeDir dir	
      in
        fileList
      end

    (* Check each file in directory 'dir' to see if it matches 'searchFile'.
     Check any subdirectories by a recursive call to checkDir. *)

    and checkFile (searchFile, dir) =
      case (OS.FileSys.readDir dir) of

	(* If at end of directory then return an empty list. *)
	"" => []
      | file =>
	  
	  (* If file is a child directory then it must be searched as well. *)
	  if isChildDir file then
	    checkDir (searchFile, file) @@
	    checkFile (searchFile, dir) 
	  else
	  
	    (* If file matches 'searchFile, add current path to the list. *)
	    if Match.match (file, searchFile) then 
	      OS.FileSys.fullPath file :: 
	      checkFile (searchFile, dir)
	    else
	      checkFile (searchFile, dir)


    (* Search all files in the directory 'path' and its subdirectories, and
     print all occurrences that match 'filename'.  Make sure user is returned
     to original directory even if OS.SysErr has been raised. *)

    fun find (filename, path) = 
      let
	fun fileFind () =
	  let
	    val userPath = OS.FileSys.getDir ()
	    fun display path = print ("\nFile: " ^ OS.Path.file path ^ 
				      "\nDir:  " ^ OS.Path.dir path ^ "\n")
	  in 
	    app display (checkDir (filename, path))
	    handle OS.SysErr (message, error) => 
	      (print ("System error whilst searching directory " ^
		      OS.FileSys.getDir () ^ "\n" ^ message ^ "\n");
	       OS.FileSys.chDir userPath)
	  end
      in
	fileFind ()
	handle OS.SysErr _ => print ("Directory error.\n")
      end

  end


@


1.2.8.1
log
@branched from trunk for label MLWorks_workspace_97
@
text
@a14 3
 *  Revision 1.2  1996/09/04  11:53:17  jont
 *  Make require statements absolute
 *
@


1.2.7.1
log
@branched from 1.2
@
text
@a14 3
 *  Revision 1.2  1996/09/04  11:53:17  jont
 *  Make require statements absolute
 *
@


1.2.7.1.3.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r3
@
text
@a14 3
 *  Revision 1.2.7.1  1997/05/12  10:24:58  hope
 *  branched from 1.2
 *
@


1.2.7.1.2.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r2_551
@
text
@a14 3
 *  Revision 1.2.7.1  1997/05/12  10:24:58  hope
 *  branched from 1.2
 *
@


1.2.7.1.1.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
@
text
@a14 3
 *  Revision 1.2.7.1  1997/05/12  10:24:58  hope
 *  branched from 1.2
 *
@


1.2.7.1.1.1.1.1
log
@branched from MLWorks_11 for label MLWorks_11r1
@
text
@a14 3
 *  Revision 1.2.7.1.1.1  1997/07/28  18:10:14  daveb
 *  branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
 *
@


1.2.6.1
log
@branched from 1.2
@
text
@a14 3
 *  Revision 1.2  1996/09/04  11:53:17  jont
 *  Make require statements absolute
 *
@


1.2.6.1.1.1
log
@branched from 1.2.6.1
@
text
@a14 3
 *  Revision 1.2.6.1  1996/12/17  17:39:57  hope
 *  branched from 1.2
 *
@


1.2.5.1
log
@branched from 1.2
@
text
@a14 3
 *  Revision 1.2  1996/09/04  11:53:17  jont
 *  Make require statements absolute
 *
@


1.2.4.1
log
@branched from 1.2
@
text
@a14 3
 *  Revision 1.2  1996/09/04  11:53:17  jont
 *  Make require statements absolute
 *
@


1.2.4.1.1.1
log
@branched from 1.2.4.1
@
text
@a14 3
 *  Revision 1.2.4.1  1996/11/14  12:40:36  hope
 *  branched from 1.2
 *
@


1.2.3.1
log
@branched from 1.2
@
text
@a14 3
 *  Revision 1.2  1996/09/04  11:53:17  jont
 *  Make require statements absolute
 *
@


1.2.2.1
log
@branched from 1.2
@
text
@a14 3
 *  Revision 1.2  1996/09/04  11:53:17  jont
 *  Make require statements absolute
 *
@


1.2.1.1
log
@branched from 1.2
@
text
@a14 3
 *  Revision 1.2  1996/09/04  11:53:17  jont
 *  Make require statements absolute
 *
@


1.1
log
@new unit
@
text
@d14 4
a17 1
 *  $Log$
d24 1
a24 1
require "system.__os";
@
