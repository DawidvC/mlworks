head	1.4;
access;
symbols
	MLWorks_21c0_1999_03_25:1.4
	MLWorks_20c1_1998_08_20:1.4
	MLWorks_20c0_1998_08_04:1.4
	MLWorks_20b2c2_1998_06_19:1.4
	MLWorks_20b2_Windows_1998_06_12:1.4
	MLWorks_20b1c1_1998_05_07:1.4
	MLWorks_20b0_1998_04_07:1.4
	MLWorks_20b0_1998_03_20:1.4
	MLWorks_20m2_1998_02_16:1.4
	MLWorks_workspace_97:1.4.2
	MLWorks_20m1_1997_10_23:1.4
	MLWorks_11r1:1.4.1.1.1.1.1
	MLWorks_11c0_1997_09_09:1.4.1.1.1.1
	MLWorks_10r3:1.4.1.1.3
	MLWorks_10r2_551:1.4.1.1.2
	MLWorks_11:1.4.1.1.1
	MLWorks_1_0_r2c2_1997_07_28:1.4.1.1
	MLWorks_20m0_1997_06_20:1.4
	MLWorks_1_0_r2c2_1997_06_14:1.4.1.1
	MLWorks_1_0_r2c1_released_1997_05_23:1.4.1.1
	MLWorks_1_0_r2c1_1997_05_12:1.4.1
	MLWorks_BugFix_1997_04_24:1.4
	MLWorks_1_0_r2_Win32_1997_04_11:1.4
	MLWorks_1_0_r2_Unix_1997_04_04:1.4
	MLWorks_1_0_1_ULTRASPARC_1997_02_24:1.3.6.1.1
	MLWorks_1_0_Win32_1996_12_17:1.3.6
	MLWorks_1_0_Irix_1996_11_28_released_1996_12_17:1.3.4.1.1.1
	MLWorks_1_0_Unix_1996_11_14_released_1996_12_17:1.3.4.1
	MLWorks_1_0_Irix_1996_11_28:1.3.4.1.1
	MLWorks_1_0_Win32_1996_11_22:1.3.5
	MLWorks_1_0_Unix_1996_11_14:1.3.4
	MLWorks_Open_Beta2_1996_10_11:1.3.3
	MLWorks_License_dev:1.3.2
	MLWorks_1_open_beta_1996_09_13:1.3.1
	MLWorks_Open_Beta_1996_08_22:1.2;
locks; strict;
comment	@ *  @;


1.4
date	96.11.16.11.30.16;	author io;	state Exp;
branches
	1.4.1.1
	1.4.2.1;
next	1.3;

1.3
date	96.09.04.11.56.00;	author jont;	state Exp;
branches
	1.3.1.1
	1.3.2.1
	1.3.3.1
	1.3.4.1
	1.3.5.1
	1.3.6.1;
next	1.2;

1.2
date	96.08.09.15.43.16;	author davids;	state Exp;
branches;
next	1.1;

1.1
date	96.08.02.10.42.14;	author davids;	state Exp;
branches;
next	;

1.3.1.1
date	96.09.13.11.07.00;	author hope;	state Exp;
branches;
next	;

1.3.2.1
date	96.10.07.15.58.05;	author hope;	state Exp;
branches;
next	;

1.3.3.1
date	96.10.17.11.16.26;	author hope;	state Exp;
branches;
next	;

1.3.4.1
date	96.11.14.12.39.30;	author hope;	state Exp;
branches
	1.3.4.1.1.1;
next	;

1.3.4.1.1.1
date	96.11.28.14.51.29;	author hope;	state Exp;
branches;
next	;

1.3.5.1
date	96.11.22.18.00.06;	author hope;	state Exp;
branches;
next	;

1.3.6.1
date	96.12.17.17.39.02;	author hope;	state Exp;
branches
	1.3.6.1.1.1;
next	;

1.3.6.1.1.1
date	97.02.24.11.26.13;	author hope;	state Exp;
branches;
next	;

1.4.1.1
date	97.05.12.10.23.58;	author hope;	state Exp;
branches
	1.4.1.1.1.1
	1.4.1.1.2.1
	1.4.1.1.3.1;
next	;

1.4.1.1.1.1
date	97.07.28.18.09.58;	author daveb;	state Exp;
branches
	1.4.1.1.1.1.1.1;
next	;

1.4.1.1.1.1.1.1
date	97.10.07.11.33.48;	author jkbrook;	state Exp;
branches;
next	;

1.4.1.1.2.1
date	97.09.08.17.03.18;	author daveb;	state Exp;
branches;
next	;

1.4.1.1.3.1
date	97.09.09.13.57.52;	author daveb;	state Exp;
branches;
next	;

1.4.2.1
date	97.11.30.16.48.20;	author daveb;	state Exp;
branches;
next	;


desc
@new unit
@


1.4
log
@[Bug #1757]
renamed __ieeereal
@
text
@(*  ==== BASIS EXAMPLES : Rounding structure ====
 *
 *  Copyright (C) 1996 Harlequin Ltd.
 *
 *  Description
 *  -----------
 *  This module demonstrates the four different IEEE rounding modes.
 *  It illustrates the use of the IEEEReal, StringCvt and TextIO structures
 *  in the basis library.  The example file "reals" may be used with this
 *  structure.
 *
 *  Revision Log
 *  ------------
 *  $Log: basis:__rounding.sml,v $
 *  Revision 1.3  1996/09/04  11:56:00  jont
 *  Make require statements absolute
 *
 *  Revision 1.2  1996/08/09  15:43:16  davids
 *  Stream now closed after use.
 *
 *  Revision 1.1  1996/08/02  10:42:14  davids
 *  new unit
 *
 *
 *)


require "rounding";
require "$.basis.__ieee_real";
require "$.basis.__string_cvt";
require "$.basis.__text_io";
require "$.basis.__real";
require "$.basis.__io";

structure Rounding : ROUNDING =
  struct

    val columnWidth = 18


    (* Skip past any comments in the stream.  These are denoted by a '#'. *)

    fun skipComments strm =
      case (TextIO.lookahead strm) of
        SOME #"#" => (ignore (TextIO.inputLine strm);
		      skipComments strm)
      | _ => strm


    (* Scan real numbers in from a stream, producing a list. *) 

    fun inputReals strm =
       case TextIO.scanStream Real.scan strm of
	 NONE => []
       | SOME x => x :: inputReals strm
  

    (* Scan in a list of real numbers from 'file', and then convert them
     into strings.  Each real is truncated to 'decimals' places, using the
     current rounding mode.  If decimals is NONE, the default number of
     decimal places will be used. *)

    fun getReals (file, decimals) = 
      let
	fun toRealText x = Real.fmt (StringCvt.FIX decimals) x
	val strm = skipComments (TextIO.openIn file)
	val realText = map toRealText (inputReals strm)
	val _ = TextIO.closeIn strm
      in
	realText
      end


    (* Print out four strings neatly in a table. *)

    fun printTableLine (col1, col2, col3, col4) =
      TextIO.print (StringCvt.padLeft #" " columnWidth col1 ^ " " ^
		    StringCvt.padLeft #" " columnWidth col2 ^ " " ^
		    StringCvt.padLeft #" " columnWidth col3 ^ " " ^
		    StringCvt.padLeft #" " columnWidth col4 ^ "\n")


    (* Print out four lists neatly in a table. *)

    fun printReals ([], [], [], []) = TextIO.print ""
      | printReals ((h1::t1), (h2::t2), (h3::t3), (h4::t4)) =
	(printTableLine (h1, h2, h3, h4);
	 printReals (t1, t2, t3, t4))
      | printReals _ = raise Fail "File altered during input."


    (* For each of the four rounding modes, read in a list of real numbers
     from 'file', and use that rounding mode to truncate to 'decimals'
     places.  Print the results in a table. *)

    fun roundingTable (file, decimals) =
      let
	val toNearest = 
	  (IEEEReal.setRoundingMode IEEEReal.TO_NEAREST;
	   getReals (file, decimals))
	val toNeginf = 
	  (IEEEReal.setRoundingMode IEEEReal.TO_NEGINF;
	   getReals (file, decimals))
	val toPosinf = 
	  (IEEEReal.setRoundingMode IEEEReal.TO_POSINF;
	   getReals (file, decimals))
	val toZero = 
	  (IEEEReal.setRoundingMode IEEEReal.TO_ZERO;
	   getReals (file, decimals))
      in
	(printTableLine ("To nearest:", "To -inf:", "To +inf:", "To zero:");
	 printReals (toNearest, toNeginf, toPosinf, toZero))
      end


    (* Print table of results, or an appropriate message if the Io exception
     has been raised. *)

    fun roundingDemo (file, decimals) =
      roundingTable (file, decimals)
      handle IO.Io _ => TextIO.print ("Error reading file.\n")
	   | Fail message => TextIO.print message

  end


@


1.4.2.1
log
@branched from trunk for label MLWorks_workspace_97
@
text
@a14 4
 *  Revision 1.4  1996/11/16  11:30:16  io
 *  [Bug #1757]
 *  renamed __ieeereal
 *
@


1.4.1.1
log
@branched from 1.4
@
text
@a14 4
 *  Revision 1.4  1996/11/16  11:30:16  io
 *  [Bug #1757]
 *  renamed __ieeereal
 *
@


1.4.1.1.3.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r3
@
text
@a14 3
 *  Revision 1.4.1.1  1997/05/12  10:23:58  hope
 *  branched from 1.4
 *
@


1.4.1.1.2.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r2_551
@
text
@a14 3
 *  Revision 1.4.1.1  1997/05/12  10:23:58  hope
 *  branched from 1.4
 *
@


1.4.1.1.1.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
@
text
@a14 3
 *  Revision 1.4.1.1  1997/05/12  10:23:58  hope
 *  branched from 1.4
 *
@


1.4.1.1.1.1.1.1
log
@branched from MLWorks_11 for label MLWorks_11r1
@
text
@a14 3
 *  Revision 1.4.1.1.1.1  1997/07/28  18:09:58  daveb
 *  branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
 *
@


1.3
log
@Make require statements absolute
@
text
@d15 3
d29 1
a29 1
require "$.basis.__ieeereal";
@


1.3.6.1
log
@branched from 1.3
@
text
@a14 3
 *  Revision 1.3  1996/09/04  11:56:00  jont
 *  Make require statements absolute
 *
@


1.3.6.1.1.1
log
@branched from 1.3.6.1
@
text
@a14 3
 *  Revision 1.3.6.1  1996/12/17  17:39:02  hope
 *  branched from 1.3
 *
@


1.3.5.1
log
@branched from 1.3
@
text
@a14 3
 *  Revision 1.3  1996/09/04  11:56:00  jont
 *  Make require statements absolute
 *
@


1.3.4.1
log
@branched from 1.3
@
text
@a14 3
 *  Revision 1.3  1996/09/04  11:56:00  jont
 *  Make require statements absolute
 *
@


1.3.4.1.1.1
log
@branched from 1.3.4.1
@
text
@a14 3
 *  Revision 1.3.4.1  1996/11/14  12:39:30  hope
 *  branched from 1.3
 *
@


1.3.3.1
log
@branched from 1.3
@
text
@a14 3
 *  Revision 1.3  1996/09/04  11:56:00  jont
 *  Make require statements absolute
 *
@


1.3.2.1
log
@branched from 1.3
@
text
@a14 3
 *  Revision 1.3  1996/09/04  11:56:00  jont
 *  Make require statements absolute
 *
@


1.3.1.1
log
@branched from 1.3
@
text
@a14 3
 *  Revision 1.3  1996/09/04  11:56:00  jont
 *  Make require statements absolute
 *
@


1.2
log
@Stream now closed after use.
@
text
@d15 3
d26 5
a30 5
require "basis.__ieeereal";
require "basis.__string_cvt";
require "basis.__text_io";
require "basis.__real";
require "basis.__io";
@


1.1
log
@new unit
@
text
@d7 1
a7 1
 *  This module demonstrates the four IEEE rounding modes that can be used.
d14 4
a17 1
 *  $Log$
d54 2
a55 1
     current rounding mode. *)
d59 1
a59 1
	fun realText x = Real.fmt (StringCvt.FIX decimals) x
d61 2
d64 1
a64 1
	map realText (inputReals strm)
d117 1
@
