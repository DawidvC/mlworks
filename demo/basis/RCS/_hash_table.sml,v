head	1.2;
access;
symbols
	MLWorks_21c0_1999_03_25:1.2
	MLWorks_20c1_1998_08_20:1.2
	MLWorks_20c0_1998_08_04:1.2
	MLWorks_20b2c2_1998_06_19:1.2
	MLWorks_20b2_Windows_1998_06_12:1.2
	MLWorks_20b1c1_1998_05_07:1.2
	MLWorks_20b0_1998_04_07:1.2
	MLWorks_20b0_1998_03_20:1.2
	MLWorks_20m2_1998_02_16:1.2
	MLWorks_workspace_97:1.2.8
	MLWorks_20m1_1997_10_23:1.2
	MLWorks_11r1:1.2.7.1.1.1.1
	MLWorks_11c0_1997_09_09:1.2.7.1.1.1
	MLWorks_10r3:1.2.7.1.3
	MLWorks_10r2_551:1.2.7.1.2
	MLWorks_11:1.2.7.1.1
	MLWorks_1_0_r2c2_1997_07_28:1.2.7.1
	MLWorks_20m0_1997_06_20:1.2
	MLWorks_1_0_r2c2_1997_06_14:1.2.7.1
	MLWorks_1_0_r2c1_released_1997_05_23:1.2.7.1
	MLWorks_1_0_r2c1_1997_05_12:1.2.7
	MLWorks_BugFix_1997_04_24:1.2
	MLWorks_1_0_r2_Win32_1997_04_11:1.2
	MLWorks_1_0_r2_Unix_1997_04_04:1.2
	MLWorks_1_0_1_ULTRASPARC_1997_02_24:1.2.6.1.1
	MLWorks_1_0_Win32_1996_12_17:1.2.6
	MLWorks_1_0_Irix_1996_11_28_released_1996_12_17:1.2.4.1.1.1
	MLWorks_1_0_Unix_1996_11_14_released_1996_12_17:1.2.4.1
	MLWorks_1_0_Irix_1996_11_28:1.2.4.1.1
	MLWorks_1_0_Win32_1996_11_22:1.2.5
	MLWorks_1_0_Unix_1996_11_14:1.2.4
	MLWorks_Open_Beta2_1996_10_11:1.2.3
	MLWorks_License_dev:1.2.2
	MLWorks_1_open_beta_1996_09_13:1.2.1
	MLWorks_Open_Beta_1996_08_22:1.1;
locks; strict;
comment	@ *  @;


1.2
date	96.09.04.11.56.41;	author jont;	state Exp;
branches
	1.2.1.1
	1.2.2.1
	1.2.3.1
	1.2.4.1
	1.2.5.1
	1.2.6.1
	1.2.7.1
	1.2.8.1;
next	1.1;

1.1
date	96.08.12.10.34.31;	author davids;	state Exp;
branches;
next	;

1.2.1.1
date	96.09.13.11.07.12;	author hope;	state Exp;
branches;
next	;

1.2.2.1
date	96.10.07.15.58.22;	author hope;	state Exp;
branches;
next	;

1.2.3.1
date	96.10.17.11.16.40;	author hope;	state Exp;
branches;
next	;

1.2.4.1
date	96.11.14.12.40.03;	author hope;	state Exp;
branches
	1.2.4.1.1.1;
next	;

1.2.4.1.1.1
date	96.11.28.14.51.55;	author hope;	state Exp;
branches;
next	;

1.2.5.1
date	96.11.22.18.00.33;	author hope;	state Exp;
branches;
next	;

1.2.6.1
date	96.12.17.17.39.26;	author hope;	state Exp;
branches
	1.2.6.1.1.1;
next	;

1.2.6.1.1.1
date	97.02.24.11.26.36;	author hope;	state Exp;
branches;
next	;

1.2.7.1
date	97.05.12.10.24.24;	author hope;	state Exp;
branches
	1.2.7.1.1.1
	1.2.7.1.2.1
	1.2.7.1.3.1;
next	;

1.2.7.1.1.1
date	97.07.28.18.11.03;	author daveb;	state Exp;
branches
	1.2.7.1.1.1.1.1;
next	;

1.2.7.1.1.1.1.1
date	97.10.07.11.35.37;	author jkbrook;	state Exp;
branches;
next	;

1.2.7.1.2.1
date	97.09.08.17.04.22;	author daveb;	state Exp;
branches;
next	;

1.2.7.1.3.1
date	97.09.09.13.59.24;	author daveb;	state Exp;
branches;
next	;

1.2.8.1
date	97.11.30.16.49.25;	author daveb;	state Exp;
branches;
next	;


desc
@new unit
@


1.2
log
@Make require statements absolute
@
text
@(*  ==== BASIS EXAMPLES : HashTable functor ====
 *
 *  Copyright (C) 1996 Harlequin Ltd.
 *
 *  Description
 *  -----------
 *  This module defines functions for creating and using a hash table.  It
 *  illustrates the use of the Array structure in the basis library.
 *
 *  Revision Log
 *  ------------
 *  $Log: basis:_hash_table.sml,v $
 *  Revision 1.1  1996/08/12  10:34:31  davids
 *  new unit
 *
 *
 *)


require "hash_table";
require "key";
require "__prime";
require "$.basis.__array";

functor HashTable (Key: KEY) : HASH_TABLE =
  struct

    (* Indicates that the hash table is full. *)

    exception Full

 
    (* This is the type of the key used in the hash table. *)

    type key = Key.key


    (* This type is used for entries in the hash table.  It represents either
     a (key, item) pair, an empty entry, or a deleted entry. *)

    datatype 'a item_pair = PAIR of key * 'a | EMPTY | DELETED
   

    (* This type represents a hash table of type 'a. *)

    type 'a hash_table = 'a item_pair Array.array


    (* Create a hash table with 'size' entries.  Any 'element' can be given -
     this argument is only used to resolve the polymorphism so that this
     function can be used at the top level.  Report a warning if 'size' is
     not prime. *)

    fun create (size, element) = 
      (if Prime.testPrime (size, 5) then
	 ()
       else
	 print "Warning: table size should be a prime number.\n";
       Array.array (size, EMPTY))


    (* Insert item 'newItem' into the hash table 'table' according to its 
     key 'newKey'.  If there is no space left in the hash table, then the
     exception Full is raised. *)

    fun insert (table, newKey, newItem) = 
      let
	val size = Array.length table
	fun insert' (i, probes) =
	  if probes >= size then
	    raise Full
	  else
	    case Array.sub (table, i) of
	      EMPTY => Array.update (table, i, PAIR (newKey, newItem))
	    | DELETED => Array.update (table, i, PAIR (newKey, newItem))
	    | PAIR (_, _) => insert' (Key.rehash (newKey, i, size), probes + 1)
      in
	insert' (Key.hash (newKey, size), 0)
      end


    (* Find the item in the hash table 'table' with key 'searchKey'.  Return
     both the item itself, and the position in the table it was found at. 
     If no match is found then return NONE. *)

    fun find (table, searchKey) = 
      let
	val size = Array.length table
	fun find' (i, probes) =
	  if probes >= size then
	    NONE
	  else
	    case Array.sub (table, i) of
	      EMPTY => NONE
	    | DELETED => find' (Key.rehash (searchKey, i, size), probes + 1)
	    | PAIR (itemKey, item) => 
	      if itemKey = searchKey then 
		SOME (item, i)
	      else 
		find' (Key.rehash (searchKey, i, size), probes + 1)
      in
	find' (Key.hash (searchKey, size), 0)
      end


    (* Find the item in the hash table 'table' with key 'searchKey'.  If found
     then return the item, otherwise return NONE. *)

    fun lookUp (table, searchKey) = 
      case find (table, searchKey) of
	NONE => NONE
      | SOME (item, i) => SOME item


    (* Remove the item in the hash table 'table' with key 'searchKey'.  If
     found then return the item, otherwise return NONE. *)

    fun remove (table, searchKey) =
      case find (table, searchKey) of
	NONE => NONE
      | SOME (item, index) => 
	  (Array.update (table, index, DELETED);
	   SOME item)

  end





@


1.2.8.1
log
@branched from trunk for label MLWorks_workspace_97
@
text
@a12 3
 *  Revision 1.2  1996/09/04  11:56:41  jont
 *  Make require statements absolute
 *
@


1.2.7.1
log
@branched from 1.2
@
text
@a12 3
 *  Revision 1.2  1996/09/04  11:56:41  jont
 *  Make require statements absolute
 *
@


1.2.7.1.3.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r3
@
text
@a12 3
 *  Revision 1.2.7.1  1997/05/12  10:24:24  hope
 *  branched from 1.2
 *
@


1.2.7.1.2.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r2_551
@
text
@a12 3
 *  Revision 1.2.7.1  1997/05/12  10:24:24  hope
 *  branched from 1.2
 *
@


1.2.7.1.1.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
@
text
@a12 3
 *  Revision 1.2.7.1  1997/05/12  10:24:24  hope
 *  branched from 1.2
 *
@


1.2.7.1.1.1.1.1
log
@branched from MLWorks_11 for label MLWorks_11r1
@
text
@a12 3
 *  Revision 1.2.7.1.1.1  1997/07/28  18:11:03  daveb
 *  branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
 *
@


1.2.6.1
log
@branched from 1.2
@
text
@a12 3
 *  Revision 1.2  1996/09/04  11:56:41  jont
 *  Make require statements absolute
 *
@


1.2.6.1.1.1
log
@branched from 1.2.6.1
@
text
@a12 3
 *  Revision 1.2.6.1  1996/12/17  17:39:26  hope
 *  branched from 1.2
 *
@


1.2.5.1
log
@branched from 1.2
@
text
@a12 3
 *  Revision 1.2  1996/09/04  11:56:41  jont
 *  Make require statements absolute
 *
@


1.2.4.1
log
@branched from 1.2
@
text
@a12 3
 *  Revision 1.2  1996/09/04  11:56:41  jont
 *  Make require statements absolute
 *
@


1.2.4.1.1.1
log
@branched from 1.2.4.1
@
text
@a12 3
 *  Revision 1.2.4.1  1996/11/14  12:40:03  hope
 *  branched from 1.2
 *
@


1.2.3.1
log
@branched from 1.2
@
text
@a12 3
 *  Revision 1.2  1996/09/04  11:56:41  jont
 *  Make require statements absolute
 *
@


1.2.2.1
log
@branched from 1.2
@
text
@a12 3
 *  Revision 1.2  1996/09/04  11:56:41  jont
 *  Make require statements absolute
 *
@


1.2.1.1
log
@branched from 1.2
@
text
@a12 3
 *  Revision 1.2  1996/09/04  11:56:41  jont
 *  Make require statements absolute
 *
@


1.1
log
@new unit
@
text
@d12 4
a15 1
 *  $Log$
d23 1
a23 1
require "basis.__array";
@
