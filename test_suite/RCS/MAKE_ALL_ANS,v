head	1.12;
access;
symbols
	MLWorks_21c0_1999_03_25:1.12
	MLWorks_20c1_1998_08_20:1.12
	MLWorks_20c0_1998_08_04:1.12
	MLWorks_20b2c2_1998_06_19:1.12
	MLWorks_20b2_Windows_1998_06_12:1.12
	MLWorks_20b1c1_1998_05_07:1.12
	MLWorks_20b0_1998_04_07:1.12
	MLWorks_20b0_1998_03_20:1.12
	MLWorks_20m2_1998_02_16:1.12
	MLWorks_20m1_1997_10_23:1.12
	MLWorks_11r1:1.12.8.1.1.1.1
	MLWorks_11c0_1997_09_09:1.12.8.1.1.1
	MLWorks_10r3:1.12.8.1.3
	MLWorks_10r2_551:1.12.8.1.2
	MLWorks_11:1.12.8.1.1
	MLWorks_1_0_r2c2_1997_07_28:1.12.8.1
	MLWorks_20m0_1997_06_20:1.12
	MLWorks_1_0_r2c2_1997_06_14:1.12.8.1
	MLWorks_1_0_r2c1_released_1997_05_23:1.12.8.1
	MLWorks_1_0_r2c1_1997_05_12:1.12.8
	MLWorks_BugFix_1997_04_24:1.12
	MLWorks_1_0_r2_Win32_1997_04_11:1.12
	MLWorks_1_0_r2_Unix_1997_04_04:1.12
	MLWorks_1_0_1_ULTRASPARC_1997_02_24:1.12.6.1.1
	MLWorks_gui_1996_12_18:1.12.7
	MLWorks_1_0_Win32_1996_12_17:1.12.6
	MLWorks_1_0_Irix_1996_11_28_released_1996_12_17:1.12.4.1.1.1
	MLWorks_1_0_Unix_1996_11_14_released_1996_12_17:1.12.4.1
	MLWorks_1_0_Irix_1996_11_28:1.12.4.1.1
	MLWorks_1_0_Win32_1996_11_22:1.12.5
	MLWorks_1_0_Unix_1996_11_14:1.12.4
	MLWorks_Open_Beta2_1996_10_11:1.12.3
	MLWorks_License_dev:1.12.2
	MLWorks_1_open_beta_1996_09_13:1.12.1
	MLWorks_Open_Beta_1996_08_22:1.12
	MLWorks_Beta_1996_07_02:1.12
	MLWorks_Beta_1996_06_07:1.12
	MLWorks_Beta_1996_06_06:1.12
	MLWorks_Beta_1996_06_05:1.12
	MLWorks_Beta_1996_06_03:1.12
	MLWorks_Beta_1996_05_31:1.12
	MLWorks_Beta_1996_05_30:1.12
	ML_beta_release_12/08/94:1.7
	ML_beta_release_03/08/94:1.7
	ML_revised_beta_release_25/05/94:1.6
	ML_final_beta_release_02/03/94:1.5
	mlworks-28-01-1994:1.5
	Release:1.4
	mlworks-beta-01-09-1993:1.4
	MLWorks-1-0-4-29/01/1993:1.2;
locks; strict;
comment	@# @;


1.12
date	96.05.22.15.01.41;	author jont;	state Exp;
branches
	1.12.1.1
	1.12.2.1
	1.12.3.1
	1.12.4.1
	1.12.5.1
	1.12.6.1
	1.12.7.1
	1.12.8.1;
next	1.11;

1.11
date	96.01.09.12.47.57;	author matthew;	state Exp;
branches;
next	1.10;

1.10
date	95.08.15.11.51.18;	author daveb;	state Exp;
branches;
next	1.9;

1.9
date	95.03.15.14.35.46;	author jont;	state Exp;
branches;
next	1.8;

1.8
date	95.02.09.15.16.08;	author jont;	state Exp;
branches;
next	1.7;

1.7
date	94.06.17.12.11.33;	author daveb;	state Exp;
branches;
next	1.6;

1.6
date	94.03.15.14.48.13;	author jont;	state Exp;
branches;
next	1.5;

1.5
date	93.09.28.14.17.33;	author daveb;	state Exp;
branches;
next	1.4;

1.4
date	93.04.14.16.30.50;	author daveb;	state Exp;
branches
	1.4.1.1;
next	1.3;

1.3
date	93.04.14.15.01.57;	author daveb;	state Exp;
branches;
next	1.2;

1.2
date	93.01.22.16.21.39;	author daveb;	state Exp;
branches;
next	1.1;

1.1
date	93.01.07.18.06.15;	author daveb;	state Exp;
branches;
next	;

1.4.1.1
date	93.04.14.16.30.50;	author jont;	state Exp;
branches;
next	1.4.1.2;

1.4.1.2
date	93.09.28.13.30.27;	author daveb;	state Exp;
branches;
next	;

1.12.1.1
date	96.09.13.11.27.13;	author hope;	state Exp;
branches;
next	;

1.12.2.1
date	96.10.07.16.17.47;	author hope;	state Exp;
branches;
next	;

1.12.3.1
date	96.10.17.11.37.41;	author hope;	state Exp;
branches;
next	;

1.12.4.1
date	96.11.14.13.05.34;	author hope;	state Exp;
branches
	1.12.4.1.1.1;
next	;

1.12.4.1.1.1
date	96.11.28.15.15.12;	author hope;	state Exp;
branches;
next	;

1.12.5.1
date	96.11.22.18.23.01;	author hope;	state Exp;
branches;
next	;

1.12.6.1
date	96.12.17.18.01.04;	author hope;	state Exp;
branches
	1.12.6.1.1.1;
next	;

1.12.6.1.1.1
date	97.02.24.11.52.45;	author hope;	state Exp;
branches;
next	;

1.12.7.1
date	96.12.18.09.56.27;	author hope;	state Exp;
branches;
next	;

1.12.8.1
date	97.05.12.10.54.26;	author hope;	state Exp;
branches
	1.12.8.1.1.1
	1.12.8.1.2.1
	1.12.8.1.3.1;
next	;

1.12.8.1.1.1
date	97.07.28.18.37.18;	author daveb;	state Exp;
branches
	1.12.8.1.1.1.1.1;
next	;

1.12.8.1.1.1.1.1
date	97.10.07.12.02.21;	author jkbrook;	state Exp;
branches;
next	;

1.12.8.1.2.1
date	97.09.08.17.29.27;	author daveb;	state Exp;
branches;
next	;

1.12.8.1.3.1
date	97.09.09.14.27.24;	author daveb;	state Exp;
branches;
next	;


desc
@Shell script to generate answer files for the entire test suite.
@


1.12
log
@Convert to sh script
@
text
@#!/bin/sh
#
# MAKE_ALL_ANS, just a dummy
#
# $Log$
#
# Copyright Harlequin Ltd. 1996.
#
MAKE_ALL_ANS.sh $*
@


1.12.8.1
log
@branched from 1.12
@
text
@d5 1
a5 4
# $Log: MAKE_ALL_ANS,v $
# Revision 1.12  1996/05/22  15:01:41  jont
# Convert to sh script
#
@


1.12.8.1.3.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r3
@
text
@a5 3
# Revision 1.12.8.1  1997/05/12  10:54:26  hope
# branched from 1.12
#
@


1.12.8.1.2.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r2_551
@
text
@a5 3
# Revision 1.12.8.1  1997/05/12  10:54:26  hope
# branched from 1.12
#
@


1.12.8.1.1.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
@
text
@a5 3
# Revision 1.12.8.1  1997/05/12  10:54:26  hope
# branched from 1.12
#
@


1.12.8.1.1.1.1.1
log
@branched from MLWorks_11 for label MLWorks_11r1
@
text
@a5 3
# Revision 1.12.8.1.1.1  1997/07/28  18:37:18  daveb
# branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
#
@


1.12.7.1
log
@branched from 1.12
@
text
@d5 1
a5 4
# $Log: MAKE_ALL_ANS,v $
# Revision 1.12  1996/05/22  15:01:41  jont
# Convert to sh script
#
@


1.12.6.1
log
@branched from 1.12
@
text
@d5 1
a5 4
# $Log: MAKE_ALL_ANS,v $
# Revision 1.12  1996/05/22  15:01:41  jont
# Convert to sh script
#
@


1.12.6.1.1.1
log
@branched from 1.12.6.1
@
text
@a5 3
# Revision 1.12.6.1  1996/12/17  18:01:04  hope
# branched from 1.12
#
@


1.12.5.1
log
@branched from 1.12
@
text
@d5 1
a5 4
# $Log: MAKE_ALL_ANS,v $
# Revision 1.12  1996/05/22  15:01:41  jont
# Convert to sh script
#
@


1.12.4.1
log
@branched from 1.12
@
text
@d5 1
a5 4
# $Log: MAKE_ALL_ANS,v $
# Revision 1.12  1996/05/22  15:01:41  jont
# Convert to sh script
#
@


1.12.4.1.1.1
log
@branched from 1.12.4.1
@
text
@a5 3
# Revision 1.12.4.1  1996/11/14  13:05:34  hope
# branched from 1.12
#
@


1.12.3.1
log
@branched from 1.12
@
text
@d5 1
a5 4
# $Log: MAKE_ALL_ANS,v $
# Revision 1.12  1996/05/22  15:01:41  jont
# Convert to sh script
#
@


1.12.2.1
log
@branched from 1.12
@
text
@d5 1
a5 4
# $Log: MAKE_ALL_ANS,v $
# Revision 1.12  1996/05/22  15:01:41  jont
# Convert to sh script
#
@


1.12.1.1
log
@branched from 1.12
@
text
@d5 1
a5 4
# $Log: MAKE_ALL_ANS,v $
# Revision 1.12  1996/05/22  15:01:41  jont
# Convert to sh script
#
@


1.11
log
@Renaming motif.img to gui.img
@
text
@d1 1
a1 5
#!/bin/csh
# MAKE_ALL_ANS
# 
# Shell script to perform regression testing on the Harlequin
# SML compiler.
d3 1
a3 3
# $Log: MAKE_ALL_ANS,v $
# Revision 1.10  1995/08/15  11:51:18  daveb
# Changed default SRC_DIR to /u/sml ...
d5 1
a5 2
# Revision 1.9  1995/03/15  14:35:46  jont
# Pass on -dir parameter
d7 1
a7 2
# Revision 1.8  1995/02/09  15:16:08  jont
# Modify to use new image directory structure
d9 1
a9 99
# Revision 1.7  1994/06/17  12:11:33  daveb
# Changed default SRC_DIR to /usr/sml ...
#
# Revision 1.6  1994/03/15  14:48:13  jont
# Change default source directory to /usr/users/sml/MLW/src
#
# Revision 1.5  1993/09/28  14:17:33  daveb
# Merged in bug fix.
#
# Revision 1.4.1.2  1993/09/28  13:30:27  daveb
# No longer generates answer files for erroneous cases.
#
# Revision 1.4.1.1  1993/04/14  16:30:50  jont
# Fork for bug fixing
#
# Revision 1.4  1993/04/14  16:30:50  daveb
# Replaced much code with a call to CHECK_SUCCESS.
#
# Revision 1.3  1993/04/14  15:01:57  daveb
# Changed interpreter.img to motif.img.  Optimised sed processing.
#
# Revision 1.2  1993/01/22  16:21:39  daveb
# Added checks on results.
#
# Revision 1.1  1993/01/07  18:06:15  daveb
# Initial revision
# 
#
# Copyright Harlequin Ltd. 1992.

set TESTDIR=.

set SRCDIR=/u/sml/MLW/src

set ARCH_OS_DIR=SPARC/SunOS

alias usage echo 'Usage: MAKE_ALL_ANS \[-src \<source dir\>\] \[-dir \<architecture/OS\>\] \[-test \< test dir\>\]'

# Argument handling here.
while ($#argv)
  switch ($1)
    case -src:
      shift
      if ($1 != "") then
        set SRCDIR=$1
	shift
      else
  	usage
	exit (1)
      endif
      breaksw
    case -dir:
      shift
      if ($1 != "") then
        set ARCH_OS_DIR=$1
        shift
      else
        usage
        exit (1)
      endif
      breaksw
    case -test:
      shift
      if ($1 != "") then
        set TESTDIR=$1
	shift
      else
  	usage
	exit (1)
      endif
      breaksw
    default:
      usage
      exit (1)
      breaksw
  endsw
end

if ( ! -x $SRCDIR/rts/runtime) then
  echo Can\'t find $SRCDIR/rts/runtime
  exit (1)
endif

if ( ! -r $SRCDIR/images/$ARCH_OS_DIR/gui.img) then
  echo Can\'t find $SRCDIR/images/$ARCH_OS_DIR/gui.img
  exit (1)
endif

cd $TESTDIR
foreach i ( */*.sml )
  if { CHECK_SUCCESS -keep -src $SRCDIR -dir $ARCH_OS_DIR $i } then
    if ! { egrep OK $i >& /dev/null } then
       echo ${i}: erroneous case, no answer file needed
       rm $i:r.out
    else
      mv $i:r.out $i:r.ans
    endif
  endif
end
@


1.10
log
@Changed default SRC_DIR to /u/sml ...
@
text
@d8 3
d100 2
a101 2
if ( ! -r $SRCDIR/images/$ARCH_OS_DIR/motif.img) then
  echo Can\'t find $SRCDIR/images/$ARCH_OS_DIR/motif.img
@


1.9
log
@Pass on -dir parameter
@
text
@d8 3
d46 1
a46 1
set SRCDIR=/usr/sml/MLW/src
@


1.8
log
@Modify to use new image directory structure
@
text
@d8 3
d101 1
a101 1
  if { CHECK_SUCCESS -keep -src $SRCDIR $i } then
@


1.7
log
@Changed default SRC_DIR to /usr/sml ...
@
text
@d8 3
d39 1
d42 1
a42 1
alias usage echo 'Usage: MAKE_ALL_ANS \[-src \<source dir\>\] \[-test \< test dir\>\]'
d44 2
d59 10
d91 2
a92 2
if ( ! -r $SRCDIR/images/motif.img) then
  echo Can\'t find $SRCDIR/images/motif.img
@


1.6
log
@Change default source directory to /usr/users/sml/MLW/src
@
text
@d8 3
d36 1
a36 1
set SRCDIR=/usr/users/sml/MLW/src
@


1.5
log
@Merged in bug fix.
@
text
@d8 3
d33 1
a33 1
set SRCDIR=/usr/users/sml/src
@


1.4
log
@Replaced much code with a call to CHECK_SUCCESS.
@
text
@d8 9
d77 6
a82 1
    mv $i:r.out $i:r.ans
@


1.4.1.1
log
@Fork for bug fixing
@
text
@a7 3
# Revision 1.4  1993/04/14  16:30:50  daveb
# Replaced much code with a call to CHECK_SUCCESS.
#
@


1.4.1.2
log
@No longer generates answer files for erroneous cases.
@
text
@a7 3
# Revision 1.4.1.1  1993/04/14  16:30:50  jont
# Fork for bug fixing
#
d71 1
a71 6
    if ! { egrep OK $i >& /dev/null } then
       echo ${i}: erroneous case, no answer file needed
       rm $i:r.out
    else
      mv $i:r.out $i:r.ans
    endif
@


1.3
log
@Changed interpreter.img to motif.img.  Optimised sed processing.
@
text
@d8 3
d67 2
a68 38
  if { egrep Result: $i >& /dev/null } then
    $SRCDIR/rts/runtime -load $SRCDIR/images/motif.img < $i | \
      sed -e '1d\
	      s/MLWorks>> //g\
	      s/MLWorks> //g' \
        >& $i:r.out
    if { egrep error $i:r.out >& /dev/null } then
      if { egrep FAIL $i >& /dev/null } then
        echo ${i}: generating new answer file.
        mv $i:r.out $i:r.ans
      else
        echo ${i}: unexpected error, see $i:r.out.
      endif
    else if { egrep warning $i:r.out >& /dev/null } then
      if { egrep WARNING $i >& /dev/null } then
        echo ${i}: generating new answer file.
        mv $i:r.out $i:r.ans
      else
        echo ${i}: unexpected warning, see $i:r.out.
      endif
    else
      if { egrep OK $i >& /dev/null } then
        echo ${i}: generating new answer file.
        mv $i:r.out $i:r.ans
      else if { egrep FAIL $i >& /dev/null } then
        echo ${i}: error expected, see $i:r.out.
      else if { egrep WARNING $i >& /dev/null } then
        echo ${i}: warning expected, see $i:r.out.
      else
        echo ${i}: bad result status.
        rm $i:r.out
      endif
    endif
    if { egrep INTERPRETATION $i >& /dev/null } then
      echo The correct behaviour in this case is open to question.
    endif
  else
    echo ${i}: missing result status.
@


1.2
log
@Added checks on results.
@
text
@d8 3
d57 2
a58 2
if ( ! -r $SRCDIR/images/interpreter.img) then
  echo Can\'t find $SRCDIR/images/interpreter.img
d65 5
a69 3
    $SRCDIR/rts/runtime -load $SRCDIR/images/interpreter.img < $i | \
      tail +2 | sed -e '1,$s/MLWorks>> //g' | sed -e '1,$s/MLWorks> //g' \
      >& $i:r.out
@


1.1
log
@Initial revision
@
text
@d7 4
a10 1
# $Log$
d61 37
a97 4
  echo Generating $i:r.ans
  $SRCDIR/rts/runtime -load $SRCDIR/images/interpreter.img < $i | \
    tail +2 | sed -e '1,$s/MLWorks>> //g' | sed -e '1,$s/MLWorks> //g' \
    >& $i:r.ans
@
