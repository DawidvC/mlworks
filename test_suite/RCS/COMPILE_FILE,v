head	1.25;
access;
symbols
	MLWorks_21c0_1999_03_25:1.25
	MLWorks_20c1_1998_08_20:1.25
	MLWorks_20c0_1998_08_04:1.25
	MLWorks_20b2c2_1998_06_19:1.25
	MLWorks_20b2_Windows_1998_06_12:1.25
	MLWorks_20b1c1_1998_05_07:1.25
	MLWorks_20b0_1998_04_07:1.25
	MLWorks_20b0_1998_03_20:1.25
	MLWorks_20m2_1998_02_16:1.25
	MLWorks_20m1_1997_10_23:1.25
	MLWorks_11r1:1.25.8.1.1.1.1
	MLWorks_11c0_1997_09_09:1.25.8.1.1.1
	MLWorks_10r3:1.25.8.1.3
	MLWorks_10r2_551:1.25.8.1.2
	MLWorks_11:1.25.8.1.1
	MLWorks_1_0_r2c2_1997_07_28:1.25.8.1
	MLWorks_20m0_1997_06_20:1.25
	MLWorks_1_0_r2c2_1997_06_14:1.25.8.1
	MLWorks_1_0_r2c1_released_1997_05_23:1.25.8.1
	MLWorks_1_0_r2c1_1997_05_12:1.25.8
	MLWorks_BugFix_1997_04_24:1.25
	MLWorks_1_0_r2_Win32_1997_04_11:1.25
	MLWorks_1_0_r2_Unix_1997_04_04:1.25
	MLWorks_1_0_1_ULTRASPARC_1997_02_24:1.25.6.1.1
	MLWorks_gui_1996_12_18:1.25.7
	MLWorks_1_0_Win32_1996_12_17:1.25.6
	MLWorks_1_0_Irix_1996_11_28_released_1996_12_17:1.25.4.1.1.1
	MLWorks_1_0_Unix_1996_11_14_released_1996_12_17:1.25.4.1
	MLWorks_1_0_Irix_1996_11_28:1.25.4.1.1
	MLWorks_1_0_Win32_1996_11_22:1.25.5
	MLWorks_1_0_Unix_1996_11_14:1.25.4
	MLWorks_Open_Beta2_1996_10_11:1.25.3
	MLWorks_License_dev:1.25.2
	MLWorks_1_open_beta_1996_09_13:1.25.1
	MLWorks_Open_Beta_1996_08_22:1.25
	MLWorks_Beta_1996_07_02:1.25
	MLWorks_Beta_1996_06_07:1.25
	MLWorks_Beta_1996_06_06:1.25
	MLWorks_Beta_1996_06_05:1.25
	MLWorks_Beta_1996_06_03:1.25
	MLWorks_Beta_1996_05_31:1.25
	MLWorks_Beta_1996_05_30:1.25
	ML_beta_release_12/08/94:1.14
	ML_beta_release_03/08/94:1.14
	ML_revised_beta_release_25/05/94:1.10
	ML_final_beta_release_02/03/94:1.9
	mlworks-28-01-1994:1.9
	Release:1.8
	mlworks-beta-01-09-1993:1.8
	MLWorks-1-0-4-29/01/1993:1.1;
locks; strict;
comment	@# @;


1.25
date	96.05.22.13.46.20;	author jont;	state Exp;
branches
	1.25.1.1
	1.25.2.1
	1.25.3.1
	1.25.4.1
	1.25.5.1
	1.25.6.1
	1.25.7.1
	1.25.8.1;
next	1.24;

1.24
date	96.01.09.12.47.43;	author matthew;	state Exp;
branches;
next	1.23;

1.23
date	95.09.21.09.46.31;	author daveb;	state Exp;
branches;
next	1.22;

1.22
date	95.09.11.16.24.20;	author matthew;	state Exp;
branches;
next	1.21;

1.21
date	95.08.24.15.27.15;	author io;	state Exp;
branches;
next	1.20;

1.20
date	95.08.15.12.37.18;	author daveb;	state Exp;
branches;
next	1.19;

1.19
date	95.03.24.14.34.45;	author jont;	state Exp;
branches;
next	1.18;

1.18
date	95.02.09.15.15.32;	author jont;	state Exp;
branches;
next	1.17;

1.17
date	95.01.26.14.46.22;	author daveb;	state Exp;
branches;
next	1.16;

1.16
date	94.10.10.17.29.02;	author daveb;	state Exp;
branches;
next	1.15;

1.15
date	94.08.24.16.39.29;	author daveb;	state Exp;
branches;
next	1.14;

1.14
date	94.07.27.10.38.04;	author daveb;	state Exp;
branches;
next	1.13;

1.13
date	94.07.27.09.44.30;	author daveb;	state Exp;
branches;
next	1.12;

1.12
date	94.06.15.10.05.29;	author daveb;	state Exp;
branches;
next	1.11;

1.11
date	94.06.08.13.20.56;	author daveb;	state Exp;
branches;
next	1.10;

1.10
date	94.03.15.14.47.55;	author jont;	state Exp;
branches;
next	1.9;

1.9
date	93.12.15.17.28.01;	author nickh;	state Exp;
branches;
next	1.8;

1.8
date	93.08.29.20.41.18;	author daveb;	state Exp;
branches
	1.8.1.1;
next	1.7;

1.7
date	93.08.28.19.11.47;	author daveb;	state Exp;
branches;
next	1.6;

1.6
date	93.06.17.08.48.05;	author matthew;	state Exp;
branches;
next	1.5;

1.5
date	93.06.04.08.42.51;	author matthew;	state Exp;
branches;
next	1.4;

1.4
date	93.05.26.11.15.30;	author matthew;	state Exp;
branches;
next	1.3;

1.3
date	93.04.14.16.49.09;	author daveb;	state Exp;
branches;
next	1.2;

1.2
date	93.04.14.14.40.39;	author daveb;	state Exp;
branches;
next	1.1;

1.1
date	93.01.27.11.40.33;	author daveb;	state Exp;
branches;
next	;

1.8.1.1
date	93.08.29.20.41.18;	author jont;	state Exp;
branches;
next	;

1.25.1.1
date	96.09.13.11.27.21;	author hope;	state Exp;
branches;
next	;

1.25.2.1
date	96.10.07.16.17.53;	author hope;	state Exp;
branches;
next	;

1.25.3.1
date	96.10.17.11.37.49;	author hope;	state Exp;
branches;
next	;

1.25.4.1
date	96.11.14.13.05.40;	author hope;	state Exp;
branches
	1.25.4.1.1.1;
next	;

1.25.4.1.1.1
date	96.11.28.15.15.19;	author hope;	state Exp;
branches;
next	;

1.25.5.1
date	96.11.22.18.23.07;	author hope;	state Exp;
branches;
next	;

1.25.6.1
date	96.12.17.18.01.10;	author hope;	state Exp;
branches
	1.25.6.1.1.1;
next	;

1.25.6.1.1.1
date	97.02.24.11.52.52;	author hope;	state Exp;
branches;
next	;

1.25.7.1
date	96.12.18.09.56.33;	author hope;	state Exp;
branches;
next	;

1.25.8.1
date	97.05.12.10.54.32;	author hope;	state Exp;
branches
	1.25.8.1.1.1
	1.25.8.1.2.1
	1.25.8.1.3.1;
next	;

1.25.8.1.1.1
date	97.07.28.18.37.10;	author daveb;	state Exp;
branches
	1.25.8.1.1.1.1.1;
next	;

1.25.8.1.1.1.1.1
date	97.10.07.12.02.14;	author jkbrook;	state Exp;
branches;
next	;

1.25.8.1.2.1
date	97.09.08.17.29.19;	author daveb;	state Exp;
branches;
next	;

1.25.8.1.3.1
date	97.09.09.14.27.16;	author daveb;	state Exp;
branches;
next	;


desc
@Script to generate output from a single test file.
@


1.25
log
@Converting to shell script
@
text
@#!/bin/sh
#
# COMPILE_FILE, just a dummy
#
# $Log$
#
# Copyright Harlequin Ltd. 1996.
#
COMPILE_FILE.sh $*
@


1.25.8.1
log
@branched from 1.25
@
text
@d5 1
a5 4
# $Log: COMPILE_FILE,v $
# Revision 1.25  1996/05/22  13:46:20  jont
# Converting to shell script
#
@


1.25.8.1.3.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r3
@
text
@a5 3
# Revision 1.25.8.1  1997/05/12  10:54:32  hope
# branched from 1.25
#
@


1.25.8.1.2.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_10r2_551
@
text
@a5 3
# Revision 1.25.8.1  1997/05/12  10:54:32  hope
# branched from 1.25
#
@


1.25.8.1.1.1
log
@branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
@
text
@a5 3
# Revision 1.25.8.1  1997/05/12  10:54:32  hope
# branched from 1.25
#
@


1.25.8.1.1.1.1.1
log
@branched from MLWorks_11 for label MLWorks_11r1
@
text
@a5 3
# Revision 1.25.8.1.1.1  1997/07/28  18:37:10  daveb
# branched from MLWorks_1_0_r2c1_1997_05_12 for label MLWorks_11
#
@


1.25.7.1
log
@branched from 1.25
@
text
@d5 1
a5 4
# $Log: COMPILE_FILE,v $
# Revision 1.25  1996/05/22  13:46:20  jont
# Converting to shell script
#
@


1.25.6.1
log
@branched from 1.25
@
text
@d5 1
a5 4
# $Log: COMPILE_FILE,v $
# Revision 1.25  1996/05/22  13:46:20  jont
# Converting to shell script
#
@


1.25.6.1.1.1
log
@branched from 1.25.6.1
@
text
@a5 3
# Revision 1.25.6.1  1996/12/17  18:01:10  hope
# branched from 1.25
#
@


1.25.5.1
log
@branched from 1.25
@
text
@d5 1
a5 4
# $Log: COMPILE_FILE,v $
# Revision 1.25  1996/05/22  13:46:20  jont
# Converting to shell script
#
@


1.25.4.1
log
@branched from 1.25
@
text
@d5 1
a5 4
# $Log: COMPILE_FILE,v $
# Revision 1.25  1996/05/22  13:46:20  jont
# Converting to shell script
#
@


1.25.4.1.1.1
log
@branched from 1.25.4.1
@
text
@a5 3
# Revision 1.25.4.1  1996/11/14  13:05:40  hope
# branched from 1.25
#
@


1.25.3.1
log
@branched from 1.25
@
text
@d5 1
a5 4
# $Log: COMPILE_FILE,v $
# Revision 1.25  1996/05/22  13:46:20  jont
# Converting to shell script
#
@


1.25.2.1
log
@branched from 1.25
@
text
@d5 1
a5 4
# $Log: COMPILE_FILE,v $
# Revision 1.25  1996/05/22  13:46:20  jont
# Converting to shell script
#
@


1.25.1.1
log
@branched from 1.25
@
text
@d5 1
a5 4
# $Log: COMPILE_FILE,v $
# Revision 1.25  1996/05/22  13:46:20  jont
# Converting to shell script
#
@


1.24
log
@Renaming motif.img to gui.img
@
text
@d1 1
a1 5
#!/bin/csh
# 
# $Log: COMPILE_FILE,v $
# Revision 1.23  1995/09/21  09:46:31  daveb
# Added flag to stop the run-time printing GC messages.
d3 1
a3 2
# Revision 1.22  1995/09/11  16:24:20  matthew
# Redirect std_err to output file also
d5 1
a5 2
# Revision 1.21  1995/08/24  15:27:15  io
# use rts/bin/$ARCH/$OS/main to help multiarch testing
d7 1
a7 2
# Revision 1.20  1995/08/15  12:37:18  daveb
# Changed default SRC_DIR to /u/sml ...
d9 1
a9 134
# Revision 1.19  1995/03/24  14:34:45  jont
# Fix use of global name compile.tmp
#
# Revision 1.18  1995/02/09  15:15:32  jont
# Modify to use new image directory structure
#
# Revision 1.17  1995/01/26  14:46:22  daveb
# Set source path to value of source directory.
#
# Revision 1.16  1994/10/10  17:29:02  daveb
# The exit status was always zero.  The only reasonable fix requires
# the use of a temp file!
#
# Revision 1.15  1994/08/24  16:39:29  daveb
# Removed previous change (which only appeared in one of two places anyway)
# in favour of changing the perl script.
#
# Revision 1.14  1994/07/27  10:38:04  daveb
# Redirected standard error into the perl script along with standard out.
#
# Revision 1.13  1994/07/27  09:44:30  daveb
# Added -tty flag to compile command.
#
# Revision 1.12  1994/06/15  10:05:29  daveb
# Changed a $1 to a $i.
#
# Revision 1.11  1994/06/08  13:20:56  daveb
# Now works for any number of arguments.  Also corrected default source
# directory.
#
# Revision 1.10  1994/03/15  14:47:55  jont
# Change default source directory to /usr/users/sml/MLW/src
#
# Revision 1.9  1993/12/15  17:28:01  nickh
# Change use of sed to use of perl (sed is brain-damaged).
#
# Revision 1.8  1993/08/29  20:41:18  daveb
# Capitalised "Setting" to match change in _io.
#
# Revision 1.7  1993/08/28  19:11:47  daveb
# Added sed commands to ignore lines beginning with Use or setting, e.g.
# setting source path to: .
# setting pervasive directory to: /usr/users/daveb/ml/src/pervasive
# Use: compiling /usr/users/daveb/.mlworks
#
# Revision 1.6  1993/06/17  08:48:05  matthew
# Changed for new prompt (MLWorks-1> rather than MLWorks%1)
#
# Revision 1.5  1993/06/04  08:42:51  matthew
# Change of prompt
#
# Revision 1.4  1993/05/26  11:15:30  matthew
# Only ignore first line -- no message for non-existent .mlworks now
#
# Revision 1.3  1993/04/14  16:49:09  daveb
# Changed sed command to delete second line of header as well as first.
#
# Revision 1.2  1993/04/14  14:40:39  daveb
# Changed interpreter.img to motif.img.
# Replaced call to tail and two calls to sed with one call to sed.
#
# Revision 1.1  1993/01/27  11:40:33  daveb
# Initial revision
#
#
# Copyright Harlequin Ltd. 1992.

set SRCDIR=/u/sml/MLW/src

set ARCH_OS_DIR=SPARC/SunOS

set id=$$

set tempfile=compile$id.tmp

alias usage echo 'Usage: COMPILE_FILE \[-src \<source dir\>\] \[-dir \<architecture/OS\>\] \<file\>'

while ($#argv)
  switch ($1)
    case -src:
      shift
      if ($1 != "") then
        set SRCDIR=$1
        shift
      else
        usage
        exit (1)
      endif
      breaksw
    case -dir:
      shift
      if ($1 != "") then
        set ARCH_OS_DIR=$1
        shift
      else
        usage
        exit (1)
      endif
      breaksw
    default:
      break
      breaksw
  endsw
end

if ( ! $#argv) then
  usage
  exit (1)
endif

if ( ! -x $SRCDIR/rts/bin/$ARCH_OS_DIR/main) then
  echo Can\'t find $SRCDIR/rts/bin/$ARCH_OS_DIR/main
  exit (1)
endif

if ( ! -r $SRCDIR/images/$ARCH_OS_DIR/gui.img) then
  echo Can\'t find $SRCDIR/images/$ARCH_OS_DIR/gui.img
  exit (1)
endif

setenv MLWORKS_SRC_PATH $SRCDIR
set STATUS=0
if ($#argv == 1) then
  $SRCDIR/rts/bin/$ARCH_OS_DIR/main -c 15 -load $SRCDIR/images/$ARCH_OS_DIR/gui.img -pass args -tty args < $1 >& $tempfile || set STATUS=1
  cat $tempfile | perl_script
else
  foreach i ($argv)
    $SRCDIR/rts/bin/$ARCH_OS_DIR/main -c 15 -load $SRCDIR/images/$ARCH_OS_DIR/gui.img -pass args -tty args < $i >& $tempfile || set STATUS=1
    echo ${i}:
    cat $tempfile | perl_script
  end
endif
rm $tempfile
exit ($STATUS)
@


1.23
log
@Added flag to stop the run-time printing GC messages.
@
text
@d4 3
d131 2
a132 2
if ( ! -r $SRCDIR/images/$ARCH_OS_DIR/motif.img) then
  echo Can\'t find $SRCDIR/images/$ARCH_OS_DIR/motif.img
d139 1
a139 1
  $SRCDIR/rts/bin/$ARCH_OS_DIR/main -c 15 -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $1 >& $tempfile || set STATUS=1
d143 1
a143 1
    $SRCDIR/rts/bin/$ARCH_OS_DIR/main -c 15 -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $i >& $tempfile || set STATUS=1
@


1.22
log
@Redirect std_err to output file also
@
text
@d4 3
d136 1
a136 1
  $SRCDIR/rts/bin/$ARCH_OS_DIR/main -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $1 >& $tempfile || set STATUS=1
d140 1
a140 1
    $SRCDIR/rts/bin/$ARCH_OS_DIR/main -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $i >& $tempfile || set STATUS=1
@


1.21
log
@use rts/bin/$ARCH/$OS/main to help multiarch testing
@
text
@d4 3
d133 1
a133 1
  $SRCDIR/rts/bin/$ARCH_OS_DIR/main -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $1 > $tempfile || set STATUS=1
d137 1
a137 1
    $SRCDIR/rts/bin/$ARCH_OS_DIR/main -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $i > $tempfile || set STATUS=1
@


1.20
log
@Changed default SRC_DIR to /u/sml ...
@
text
@d4 3
d117 2
a118 2
if ( ! -x $SRCDIR/rts/runtime) then
  echo Can\'t find $SRCDIR/rts/runtime
d130 1
a130 1
  $SRCDIR/rts/runtime -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $1 > $tempfile || set STATUS=1
d134 1
a134 1
    $SRCDIR/rts/runtime -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $i > $tempfile || set STATUS=1
@


1.19
log
@Fix use of global name compile.tmp
@
text
@d4 3
d71 1
a71 1
set SRCDIR=/usr/sml/MLW/src
@


1.18
log
@Modify to use new image directory structure
@
text
@d4 3
d72 4
d124 2
a125 2
  $SRCDIR/rts/runtime -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $1 >compile.tmp || set STATUS=1
  cat compile.tmp | perl_script
d128 1
a128 1
    $SRCDIR/rts/runtime -load $SRCDIR/images/$ARCH_OS_DIR/motif.img -pass args -tty args < $i >compile.tmp || set STATUS=1
d130 1
a130 1
    cat compile.tmp | perl_script
d133 1
a133 1
rm compile.tmp
@


1.17
log
@Set source path to value of source directory.
@
text
@d4 3
d67 3
a69 1
alias usage echo 'Usage: COMPILE_FILE \[-src \<source dir\>\] \<file\>'
d83 10
d109 2
a110 2
if ( ! -r $SRCDIR/images/motif.img) then
  echo Can\'t find $SRCDIR/images/motif.img
d117 1
a117 1
  $SRCDIR/rts/runtime -load $SRCDIR/images/motif.img -pass args -tty args < $1 >compile.tmp || set STATUS=1
d121 1
a121 1
    $SRCDIR/rts/runtime -load $SRCDIR/images/motif.img -pass args -tty args < $i >compile.tmp || set STATUS=1
@


1.16
log
@The exit status was always zero.  The only reasonable fix requires
the use of a temp file!
@
text
@d4 4
d99 1
@


1.15
log
@Removed previous change (which only appeared in one of two places anyway)
in favour of changing the perl script.
@
text
@d4 4
d95 1
d97 2
a98 1
  $SRCDIR/rts/runtime -load $SRCDIR/images/motif.img -pass args -tty args < $1 | perl_script
a99 1
  set STATUS=0
d101 1
d103 1
a103 4
    if { ($SRCDIR/rts/runtime -load $SRCDIR/images/motif.img < $i | perl_script) } then
    else
      set STATUS=1
    endif
a104 1
  exit ($STATUS)
d106 2
a107 1

@


1.14
log
@Redirected standard error into the perl script along with standard out.
@
text
@d4 3
d92 1
a92 1
  $SRCDIR/rts/runtime -load $SRCDIR/images/motif.img -pass args -tty args < $1 |& perl_script
@


1.13
log
@Added -tty flag to compile command.
@
text
@d4 3
d89 1
a89 1
  $SRCDIR/rts/runtime -load $SRCDIR/images/motif.img -pass args -tty args < $1 | perl_script
@


1.12
log
@Changed a $1 to a $i.
@
text
@d4 3
d86 1
a86 1
  $SRCDIR/rts/runtime -load $SRCDIR/images/motif.img < $1 | perl_script
@


1.11
log
@Now works for any number of arguments.  Also corrected default source
directory.
@
text
@d4 4
d88 1
a88 1
    if { ($SRCDIR/rts/runtime -load $SRCDIR/images/motif.img < $1 | perl_script) } then
@


1.10
log
@Change default source directory to /usr/users/sml/MLW/src
@
text
@d4 3
d41 1
a41 1
set SRCDIR=/usr/users/sml/MLW/src
d63 1
a63 1
if ($#argv != 1) then
d78 14
a91 1
$SRCDIR/rts/runtime -load $SRCDIR/images/motif.img < $1 | perl_script
@


1.9
log
@Change use of sed to use of perl (sed is brain-damaged).
@
text
@d4 3
d38 1
a38 1
set SRCDIR=/usr/users/sml/src
@


1.8
log
@Capitalised "Setting" to match change in _io.
@
text
@d4 3
d72 1
a72 6
$SRCDIR/rts/runtime -load $SRCDIR/images/motif.img < $1 | \
  sed -e '1,1d\
	  /^Setting/d\
	  /^Use/d\
	  s/MLWorks-1>> //g\
	  s/MLWorks-1> //g'
@


1.8.1.1
log
@Fork for bug fixing
@
text
@a3 3
# Revision 1.8  1993/08/29  20:41:18  daveb
# Capitalised "Setting" to match change in _io.
#
@


1.7
log
@Added sed commands to ignore lines beginning with Use or setting, e.g.
setting source path to: .
setting pervasive directory to: /usr/users/daveb/ml/src/pervasive
Use: compiling /usr/users/daveb/.mlworks
@
text
@d4 6
d71 1
a71 1
	  /^setting/d\
@


1.6
log
@Changed for new prompt (MLWorks-1> rather than MLWorks%1)
@
text
@d4 3
d65 2
@


1.5
log
@Change of prompt
@
text
@d4 3
d62 2
a63 2
	  s/MLWorks%1>> //g\
	  s/MLWorks%1> //g'
@


1.4
log
@Only ignore first line -- no message for non-existent .mlworks now
@
text
@d4 3
d59 2
a60 2
	  s/MLWorks>> //g\
	  s/MLWorks> //g'
@


1.3
log
@Changed sed command to delete second line of header as well as first.
@
text
@d4 3
d55 1
a55 1
  sed -e '1,2d\
@


1.2
log
@Changed interpreter.img to motif.img.
Replaced call to tail and two calls to sed with one call to sed.
@
text
@d4 4
d52 1
a52 1
  sed -e '1d\
@


1.1
log
@Initial revision
@
text
@d3 3
a5 1
# $Log$
d7 1
d42 2
a43 2
if ( ! -r $SRCDIR/images/interpreter.img) then
  echo Can\'t find $SRCDIR/images/interpreter.img
d47 4
a50 2
$SRCDIR/rts/runtime -load $SRCDIR/images/interpreter.img < $1 | \
  tail +2 | sed -e '1,$s/MLWorks>> //g' | sed -e '1,$s/MLWorks> //g'
@
