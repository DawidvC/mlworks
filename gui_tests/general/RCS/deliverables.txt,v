head	1.3;
access;
symbols
	MLWorks_21c0_1999_03_25:1.3
	MLWorks_20c1_1998_08_20:1.3
	MLWorks_20c0_1998_08_04:1.3
	MLWorks_20b2c2_1998_06_19:1.3
	MLWorks_20b2_Windows_1998_06_12:1.3
	MLWorks_20b1c1_1998_05_07:1.3
	MLWorks_20b0_1998_04_07:1.3
	MLWorks_20b0_1998_03_20:1.3
	MLWorks_20m2_1998_02_16:1.3
	MLWorks_20m1_1997_10_23:1.2;
locks; strict;
comment	@# @;


1.3
date	97.11.26.16.03.29;	author johnh;	state Exp;
branches;
next	1.2;

1.2
date	97.10.10.16.05.35;	author johnh;	state Exp;
branches;
next	1.1;

1.1
date	97.10.08.09.49.14;	author johnh;	state Exp;
branches;
next	;


desc
@new unit
Add test file for testing the closing of streams when a deliverable exits.
@


1.3
log
@[Bug #30134]
Change MLWorks.Deliver.deliver on Win32 to save exec as console apps or
windows apps.
@
text
@Request #30226: BinIO streams not flushed on program exit
8/10/97

Run the following program in a Listener, then from the command line,
execute the deliverable 'test.mlx' as specified in the program below.
The output file should contain what was sent to it, whereas before,
the output file was empty which was wrong.

------

(* With or without the call to BinIO.closeOut, the output file should
still contain the same thing and never be empty. *)

require "system/__os";
require "basis/__text_io";
require "basis/__bin_io";
require "basis/__byte";

fun printError error =
  case error of
    h :: r =>
    (TextIO.output(TextIO.stdErr, h);
     printError r)
  | [] => ();


fun testWrite(outFile, string) =
  let
    val outStream = BinIO.openOut outFile
      handle OS.SysErr(errorString, _) =>
        (printError ["Can't open output file: ", outFile, "\n",
                     errorString, "\n"];
         OS.Process.exit(OS.Process.failure))
  in
    BinIO.output(outStream, Byte.stringToBytes string)

    (* BinIO.closeOut outStream *)
  end;

fun main () =
  case MLWorks.arguments() of
    [outFile] => testWrite(outFile, "hello")
  | _ => 
      (printError ["usage: test.mlx -pass args outfile args\n"];
       OS.Process.exit(OS.Process.failure));

MLWorks.Deliver.deliver("test.mlx", main, true);

------

Request #20084:  no default .exe file extension

On Win32 platforms only:  when creating an executable, a .exe filename
extension is added to the filename if no extension is already given.

------

Request #30134: Console executable on Windows.

MLWorks.Deliver.deliver now has the type:
string * (unit -> unit) * app_style -> unit    
where 
datatype app_style = CONSOLE | WINDOWS
so the user can now specify whether to save an executable which is to
be used as a console application or a windows application.

@


1.2
log
@[Bug #20084]
Add default .exe extension if none already exists (for Win32 only).
@
text
@d55 12
@


1.1
log
@new unit
Add test file for testing the closing of streams when a deliverable exits.
@
text
@d50 5
@
